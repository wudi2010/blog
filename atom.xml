<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>吴迪的技术博客</title>
  <subtitle>天下事有难易乎？为之，则难者亦易矣；不为，则易者亦难矣</subtitle>
  <link href="/blog/atom.xml" rel="self"/>
  
  <link href="https://wudi2010.github.io/blog/"/>
  <updated>2016-12-06T07:11:34.000Z</updated>
  <id>https://wudi2010.github.io/blog/</id>
  
  <author>
    <name>wudi</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>React + Redux 基础学习笔记</title>
    <link href="https://wudi2010.github.io/blog/2016/12/05/react-and-redux-learning-note-basics/"/>
    <id>https://wudi2010.github.io/blog/2016/12/05/react-and-redux-learning-note-basics/</id>
    <published>2016-12-05T02:29:49.000Z</published>
    <updated>2016-12-06T07:11:34.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="零、环境搭建"><a href="#零、环境搭建" class="headerlink" title="零、环境搭建"></a>零、环境搭建</h1><p><strong>参考资料</strong></p>
<ul>
<li><a href="http://redux.js.org/" target="_blank" rel="external">英文原版文档</a></li>
<li><a href="http://cn.redux.js.org/" target="_blank" rel="external">中文文档</a></li>
</ul>
<p>首先要明确一点，虽然 redux 是由 flux 演变而来，但我们完全可以并且也应该抛开 react进行学习，这样可以避免一开始就陷入各种细节之中。</p>
<p>所以推荐使用 <a href="https://jsbin.com/" target="_blank" rel="external">jsbin</a> 进行调试学习，或者使用 <a href="https://github.com/facebookincubator/create-react-app" target="_blank" rel="external">react-create-app</a>作为项目脚手架。</p>
<h1 id="一、Redux是什么？"><a href="#一、Redux是什么？" class="headerlink" title="一、Redux是什么？"></a>一、Redux是什么？</h1><blockquote>
<p>Redux is a predictable state container for JavaScript apps.<br>Redux 是一个 JavaScript 状态容器，提供可预测化的状态管理。</p>
</blockquote>
<img src="/blog/2016/12/05/react-and-redux-learning-note-basics/overview.png" alt="overview.png" title="">
<p><strong>先不要在意那些细节</strong></p>
<ul>
<li>总的来说，redux 使用 store 保存并管理页面中的各种状态（state）</li>
<li>当需要改变 state 时，使用 dispatch 调用 action creators 触发 action</li>
<li>接着使用纯函数（pure function）reducer 来处理这些 action，它会根据当前 state 和 action 返回（注意这里不是修改）新的 state</li>
<li>view 层可以对于 state 进行订阅（subscribe），这样就可以得到新的 state，从而可以刷新界面（所以十分适合数据驱动的前端框架）</li>
</ul>
<blockquote>
<p>纯函数：简单的说就是对于同样的输入总是返回同样的输出，并且没有副作用的函数。（推荐学习了解下函数式编程）</p>
</blockquote>
<h2 id="1-1-为什么选择-redux？"><a href="#1-1-为什么选择-redux？" class="headerlink" title="1.1.为什么选择 redux？"></a>1.1.为什么选择 redux？</h2><ul>
<li>随着 JavaScript 单页应用开发日趋复杂，JavaScript 需要管理比任何时候都要多的 state （状态）。 这些 state 可能包括服务器响应、缓存数据、本地生成尚未持久化到服务器的数据，也包括 UI 状态，如激活的路由，被选中的标签，是否显示加载动效或者分页器等等。</li>
<li>管理不断变化的 state 非常困难。如果一个 model 的变化会引起另一个 model 变化，那么当 view 变化时，就可能引起对应 model以及另一个 model 的变化，依次地，可能会引起另一个 view 的变化。直至你搞不清楚到底发生了什么。state 在什么时候，由于什么原因，如何变化已然不受控制。 当系统变得错综复杂的时候，想重现问题或者添加新功能就会变得举步维艰。</li>
<li>如果这还不够糟糕，考虑一些来自前端开发领域的新需求，如更新调优、服务端渲染、路由跳转前请求数据等等。前端开发者正在经受前所未有的复杂性，难道就这么放弃了吗？当然不是。</li>
<li>这里的复杂性很大程度上来自于：我们总是将两个难以厘清的概念混淆在一起：<em>变化</em>和<em>异步</em>。 我称它们为曼妥思和可乐。如果把二者分开，能做的很好，但混到一起，就变得一团糟。一些库如 React 试图在视图层禁止异步和直接操作 DOM 来解决这个问题。美中不足的是，React 依旧把处理 state 中数据的问题留给了你。Redux就是为了帮你解决这个问题。</li>
<li>跟随 Flux、CQRS 和 Event Sourcing 的脚步，通过限制更新发生的时间和方式，Redux 试图让 state 的变化变得可预测。这些限制条件反映在 Redux 的 三大原则中。</li>
</ul>
<p><strong>简单总结就是使用 Redux 我们就可以没有蛀牙（大雾）</strong></p>
<ul>
<li>拥有可预测（predictable）的应用状态，所以应用的行为也是可预测的</li>
<li>因为 reducer 是纯函数，所以方便对于状态迁移进行自动化测试</li>
<li>方便地记录日志，甚至实现时间旅行（time travel）</li>
</ul>
<h2 id="1-2-三大原则（哲♂学）"><a href="#1-2-三大原则（哲♂学）" class="headerlink" title="1.2. 三大原则（哲♂学）"></a>1.2. 三大原则（哲♂学）</h2><h3 id="1-2-1-单一数据源（Single-source-of-truth）"><a href="#1-2-1-单一数据源（Single-source-of-truth）" class="headerlink" title="1.2.1. 单一数据源（Single source of truth）"></a>1.2.1. 单一数据源（Single source of truth）</h3><p>整个应用的 state 被储存在一棵 object tree 中，并且这个 object tree 只存在于唯一一个 store 中。</p>
<ul>
<li>来自服务端的 state 可以在无需编写更多代码的情况下被序列化并注入到客户端中</li>
<li>便于调试，在开发时可以将状态保存在本地</li>
<li>Undo/Redo 可以轻松实现，从而实现时间旅行</li>
</ul>
<h3 id="1-2-2-State-是只读的（State-is-read-only）"><a href="#1-2-2-State-是只读的（State-is-read-only）" class="headerlink" title="1.2.2. State 是只读的（State is read-only）"></a>1.2.2. State 是只读的（State is read-only）</h3><p>惟一改变 state 的方法就是触发 action，action 是一个用于描述已发生事件的普通对象。</p>
<p>因为所有的修改都被集中化处理，且严格按照一个接一个的顺序执行，（dispatch 同步调用 reduce 函数）因此不用担心 race condition 的出现。 Action 就是普通对象而已，因此它们可以被日志打印、序列化、储存、后期调试或测试时回放出来。</p>
<h3 id="1-2-3-使用纯函数来执行修改（Changes-are-made-with-pure-functions）"><a href="#1-2-3-使用纯函数来执行修改（Changes-are-made-with-pure-functions）" class="headerlink" title="1.2.3. 使用纯函数来执行修改（Changes are made with pure functions）"></a>1.2.3. 使用纯函数来执行修改（Changes are made with pure functions）</h3><p>为了描述 action 如何改变 state tree ，你需要编写 reducer。</p>
<p>Reducer 只是纯函数，它接收先前的 state 和 action，并返回新的 state。刚开始你可以只有一个 reducer，随着应用变大，你可以把它拆成多个小的 reducers，分别独立地操作 state tree 的不同部分。</p>
<h1 id="二、Redux-基础"><a href="#二、Redux-基础" class="headerlink" title="二、Redux 基础"></a>二、Redux 基础</h1><h2 id="2-1-action"><a href="#2-1-action" class="headerlink" title="2.1. action"></a>2.1. action</h2><p>Action 就是一个普通的 JavaScript Object。</p>
<p>redux 唯一限制的一点是必须有一个 type 属性用来表示执行哪种操作，值最好用字符串，而不是 Symbols，因为字符串是可被序列化的。</p>
<p>其他属性用来传递此次操作所需传递的数据，redux 对此不作限制，但是在设计时可以参照 Flux 标准 Action。</p>
<p><strong>简单总结 Flux Standard action 就是</strong></p>
<blockquote>
<ol>
<li>一个 action 必须是一个 JavaScript Object，并且有一个 type 属性。</li>
<li>一个 action 可以有 payload/error/meta 属性。</li>
<li>一个 action 不能有其他属性。</li>
</ol>
</blockquote>
<h2 id="2-2-reducer"><a href="#2-2-reducer" class="headerlink" title="2.2. reducer"></a>2.2. reducer</h2><p>Reducer 的工作就是接收旧的 state 和 action，返回新的 state。</p>
<blockquote>
<p>(previousState, action) =&gt; newState</p>
</blockquote>
<p>之所以称作 reducer 是因为它将被传递给 [Array.prototype.reduce(reducer, ?initialValue)] 方法。保持 reducer 纯净非常重要。永远不要在 reducer 里做这些操作：</p>
<ul>
<li>修改传入参数；</li>
<li>执行有副作用的操作，如 API 请求和路由跳转；</li>
<li>调用非纯函数，如 Date.now() 或 Math.random()。</li>
</ul>
<h2 id="2-3-store"><a href="#2-3-store" class="headerlink" title="2.3. store"></a>2.3. store</h2><p>Store 就是用来维持应用所有的 state 树的一个对象。</p>
<p>在 redux 中只有一个 store（区别于 flux 的多个 store），在 store 中保存所有的 state，可以把它当成一个封装了 state 的类。而除了对其 dispatch 一个 action 以外无法改变内部的 state。</p>
<p>在实际操作中我们只需要把根部的 reducer 函数传递给 createStore 就可以得到一个 store。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> &#123; createStore &#125; <span class="keyword">from</span> <span class="string">'redux'</span>;</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">reducer</span>(<span class="params">state, action</span>) </span>&#123;</div><div class="line">    <span class="keyword">switch</span> (action.type) &#123;</div><div class="line">        <span class="keyword">case</span> <span class="string">'SOME_ACTION'</span>:</div><div class="line">            <span class="comment">// 一些操作</span></div><div class="line">            <span class="keyword">return</span> newState; <span class="comment">// 返回新状态</span></div><div class="line">        <span class="keyword">default</span>:</div><div class="line">            <span class="keyword">return</span> state;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="keyword">const</span> store = createStore(reducer);</div></pre></td></tr></table></figure>
<p><strong>redux 中提供了这几个 api 操作 store</strong></p>
<h3 id="2-3-1-getState"><a href="#2-3-1-getState" class="headerlink" title="2.3.1. getState"></a>2.3.1. getState</h3><p>返回当前的整个 state 树。</p>
<h3 id="2-3-2-dispatch-action"><a href="#2-3-2-dispatch-action" class="headerlink" title="2.3.2. dispatch(action)"></a>2.3.2. dispatch(action)</h3><p>分发 action 给对应的 reducer。</p>
<p>该函数会调用 getState() 和传入的 action 以【同步】的方式调用 store 的 reduce 函数，然后返回新的 state。从而 state 得到了更新，并且变化监听器（change listener）会被触发。（对于异步操作则将其放到了 action creator 这个步骤）</p>
<h3 id="2-3-3-subscribe-listener"><a href="#2-3-3-subscribe-listener" class="headerlink" title="2.3.3. subscribe(listener)"></a>2.3.3. subscribe(listener)</h3><p>为 store 添加一个变化监听器，每当 dispatch 的时候就会执行，你可以在 listener（回调函数）中使用 getState() 来得到当前的 state。</p>
<p>这个 api 设计的挺有意思，它会返回一个函数，而你执行这个函数后就可以取消订阅。</p>
<h3 id="2-3-4-replaceReducer-nextReducer"><a href="#2-3-4-replaceReducer-nextReducer" class="headerlink" title="2.3.4. replaceReducer(nextReducer)"></a>2.3.4. replaceReducer(nextReducer)</h3><p>替换 store 当前用来计算 state 的 reducer。</p>
<p>这是一个高级 API。只有在你需要实现代码分隔，而且需要立即加载一些 reducer 的时候才可能会用到它。在实现 Redux 热加载机制的时候也可能会用到。</p>
<h2 id="2-4-createStore"><a href="#2-4-createStore" class="headerlink" title="2.4. createStore"></a>2.4. createStore</h2><p>忽略各种类型判断，实现一个最简的 createStore 可以用以下代码。参考资料</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> createStore = <span class="function">(<span class="params">reducer</span>) =&gt;</span> &#123;</div><div class="line">    <span class="keyword">let</span> state;</div><div class="line">    <span class="keyword">let</span> listeners = [];</div><div class="line">    <span class="keyword">const</span> getState = <span class="function"><span class="params">()</span> =&gt;</span> state;</div><div class="line">    <span class="keyword">const</span> dispatch = <span class="function">(<span class="params">action</span>) =&gt;</span> &#123;</div><div class="line">        state = reducer(state, action); <span class="comment">// 调用 reducer</span></div><div class="line">        listeners.forEach(<span class="function"><span class="params">listener</span> =&gt;</span> listener()); <span class="comment">// 调用所有变化监听器</span></div><div class="line">    &#125;;</div><div class="line">    <span class="keyword">const</span> subscribe = <span class="function">(<span class="params">listener</span>) =&gt;</span> &#123;</div><div class="line">        listeners.push(listener);</div><div class="line">        <span class="keyword">return</span> <span class="function"><span class="params">()</span> =&gt;</span> &#123;</div><div class="line">            <span class="comment">// 返回解除监听函数</span></div><div class="line">            listeners = listeners.filter(<span class="function"><span class="params">l</span> =&gt;</span> l !== listener);</div><div class="line">        &#125;;</div><div class="line">    &#125;</div><div class="line">    dispatch(&#123;&#125;); <span class="comment">// 初始化</span></div><div class="line">    <span class="keyword">return</span> &#123; getState, dispatch, subscribe &#125;;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<h2 id="2-5-计数器例子"><a href="#2-5-计数器例子" class="headerlink" title="2.5. 计数器例子"></a>2.5. 计数器例子</h2><ul>
<li>纯 JavaScript 不涉及界面（可以在右侧 console 中尝试 store.dispatch）<br><a class="jsbin-embed" href="http://jsbin.com/jetitub/embed?js,console" target="_blank" rel="external">JS Bin on jsbin.com</a><script src="http://static.jsbin.com/js/embed.min.js?3.40.2"></script></li>
<li>增加界面<br><a class="jsbin-embed" href="http://jsbin.com/kegumih/embed?html,js,output" target="_blank" rel="external">JS Bin on jsbin.com</a><script src="http://static.jsbin.com/js/embed.min.js?3.40.2"></script></li>
</ul>
<h1 id="三、与-React-进行结合"><a href="#三、与-React-进行结合" class="headerlink" title="三、与 React 进行结合"></a>三、与 React 进行结合</h1><h2 id="3-1-通过-script-标签导入-react"><a href="#3-1-通过-script-标签导入-react" class="headerlink" title="3.1. 通过 script 标签导入 react"></a>3.1. 通过 script 标签导入 react</h2><p>实现同样功能的 Counter</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 引入 createStore 方法</span></div><div class="line"><span class="keyword">const</span> &#123; createStore &#125; = Redux;</div><div class="line"><span class="comment">// var createStore = Redux.createStore;</span></div><div class="line"><span class="comment">// import &#123; createStore &#125; from 'redux';</span></div><div class="line"></div><div class="line"><span class="keyword">const</span> counter = <span class="function">(<span class="params">state = <span class="number">0</span>, action</span>) =&gt;</span> &#123;</div><div class="line">    <span class="keyword">switch</span> (action.type) &#123;</div><div class="line">        <span class="keyword">case</span> <span class="string">'INCREMENT'</span>:</div><div class="line">            <span class="keyword">return</span> state + <span class="number">1</span>;</div><div class="line">        <span class="keyword">case</span> <span class="string">'DECREMENT'</span>:</div><div class="line">            <span class="keyword">return</span> state - <span class="number">1</span>;</div><div class="line">        <span class="keyword">default</span>:</div><div class="line">            <span class="keyword">return</span> state;</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="keyword">const</span> store = createStore(counter); <span class="comment">// 创建 store 并绑定 reducer</span></div><div class="line"></div><div class="line"><span class="comment">// dump component</span></div><div class="line"><span class="keyword">const</span> Counter = (&#123; </div><div class="line">    value,</div><div class="line">    onIncrement,</div><div class="line">    onDecrement</div><div class="line">&#125;) =&gt; (</div><div class="line">    &lt;div&gt;</div><div class="line">        &lt;h1&gt;&#123;value&#125;&lt;/h1&gt;</div><div class="line">        &lt;button onClick=&#123;onIncrement&#125;&gt;+&lt;/button&gt;</div><div class="line">        &lt;button onClick=&#123;onDecrement&#125;&gt;-&lt;/button&gt;</div><div class="line">    &lt;/div&gt;</div><div class="line">);</div><div class="line"><span class="keyword">const</span> render = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</div><div class="line">    ReactDOM.render(</div><div class="line">        &lt;Counter </div><div class="line">            value=&#123;store.getState()&#125; </div><div class="line">            onIncrement=&#123;() =&gt; store.dispatch(&#123; type: 'INCREMENT' &#125;)&#125; </div><div class="line">            onDecrement=&#123;() =&gt; store.dispatch(&#123; type: 'DECREMENT' &#125;)&#125; </div><div class="line">        /&gt;,</div><div class="line">        document.getElementById('container')</div><div class="line">    );</div><div class="line">&#125;;</div><div class="line"></div><div class="line">store.subscribe(render); // change listener 监听状态变化，一旦变化则触发回调函数</div><div class="line">render();</div></pre></td></tr></table></figure>
<h2 id="3-2-用-Redux-和-React-实现-TodoApp"><a href="#3-2-用-Redux-和-React-实现-TodoApp" class="headerlink" title="3.2. 用 Redux 和 React 实现 TodoApp"></a>3.2. 用 Redux 和 React 实现 TodoApp</h2><p>在添加 react-redux 之前，为了体会下 react-redux 的作用，首先来实现一个比计数器更复杂一点儿的 TodoApp 例子~</p>
<h3 id="3-2-1-分析与设计"><a href="#3-2-1-分析与设计" class="headerlink" title="3.2.1. 分析与设计"></a>3.2.1. 分析与设计</h3><p><strong>1. 容器组件 V.S. 展示组件</strong><br>组件一般分为</p>
<p>容器组件（Smart/Container Components）<br>展示组件（Dumb/Presentational Components）</p>
<table>
<thead>
<tr>
<th></th>
<th>容器组件</th>
<th>展示组件</th>
</tr>
</thead>
<tbody>
<tr>
<td>Location</td>
<td>最顶层，路由处理</td>
<td>中间和子组件</td>
</tr>
<tr>
<td>Aware of Redux</td>
<td>是</td>
<td>否</td>
</tr>
<tr>
<td>读取数据</td>
<td>从Redux获取state</td>
<td>从props获取数据</td>
</tr>
<tr>
<td>修改数据</td>
<td>向Redux派发actions</td>
<td>从props回掉函数</td>
</tr>
</tbody>
</table>
<p>最佳实践一般是由容器组件负责一些数据的获取，进行 dispatch 等操作。而展示组件组件不应该关心逻辑，所有数据都通过 props 传入。</p>
<p>这样才能达到展示组件可以在多处复用，在具体复用时就是通过容器组件将其包装，为其提供所需的各种数据。</p>
<p><strong>2. 应用设计</strong></p>
<ul>
<li>一个 TodoApp 包含了三个部分：<ul>
<li>顶部的 AddTodo 输入部分</li>
<li>中间的 TodoList 展示部分</li>
<li>底部的 Footer 过滤部分</li>
</ul>
</li>
<li>State 应该包含：<ul>
<li>filter：过滤 todos 的条件<ul>
<li>SHOW_ALL</li>
<li>SHOW_ACTIVE</li>
<li>SHOW_COMPLETED</li>
<li>todos：所有的 todo</li>
<li>todo：包含 id、text 和 completed</li>
</ul>
</li>
</ul>
</li>
<li>然而传到应用中的 props 只需要：<ul>
<li>visibleTodos：过滤后的 todos</li>
<li>filter：过滤条件</li>
</ul>
</li>
<li>Action 应该有三种：<ul>
<li>ADD_TODO</li>
<li>TOGGLE_TODO</li>
<li>SET_VISIBILITY_FILTER<h3 id="3-2-2-编码实现"><a href="#3-2-2-编码实现" class="headerlink" title="3.2.2. 编码实现"></a>3.2.2. 编码实现</h3></li>
</ul>
</li>
</ul>
<h4 id="1-action-部分"><a href="#1-action-部分" class="headerlink" title="1. action 部分"></a>1. action 部分</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 暂且使用数字作为 id</span></div><div class="line"><span class="keyword">let</span> nextTodoId = <span class="number">0</span>;</div><div class="line"><span class="comment">/*-- action creators --*/</span></div><div class="line"><span class="keyword">const</span> addTodo = <span class="function">(<span class="params">text</span>) =&gt;</span> (</div><div class="line">    &#123; <span class="attr">type</span>: <span class="string">'ADD_TODO'</span>, <span class="attr">id</span>: nextTodoId++, text &#125;</div><div class="line">);</div><div class="line"><span class="keyword">const</span> toggleTodo = <span class="function">(<span class="params">id</span>) =&gt;</span> (</div><div class="line">    &#123; <span class="attr">type</span>: <span class="string">'TOGGLE_TODO'</span>, id &#125;</div><div class="line">);</div><div class="line"><span class="keyword">const</span> setVisibilityFilter = <span class="function">(<span class="params">filter</span>) =&gt;</span> (</div><div class="line">    &#123; <span class="attr">type</span>: <span class="string">'SET_VISIBILITY_FILTER'</span>, filter &#125;</div><div class="line">);</div></pre></td></tr></table></figure>
<h4 id="2-reducer-部分"><a href="#2-reducer-部分" class="headerlink" title="2. reducer 部分"></a>2. reducer 部分</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 默认初始状态</span></div><div class="line"><span class="keyword">const</span> initialState = &#123; <span class="attr">filter</span>: <span class="string">'SHOW_ALL'</span>, <span class="attr">todos</span>: [] &#125;;</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">rootReducer</span>(<span class="params">state = initialState, action</span>) </span>&#123;</div><div class="line">    <span class="keyword">switch</span> (action.type) &#123;</div><div class="line">        <span class="keyword">case</span> <span class="string">'ADD_TODO'</span>:</div><div class="line">            <span class="comment">// 对象解构</span></div><div class="line">            <span class="keyword">const</span> &#123; id, text &#125; = action;</div><div class="line">            <span class="keyword">return</span> &#123;</div><div class="line">                ...state,</div><div class="line">                <span class="attr">todos</span>: [</div><div class="line">                    ...state.todos,</div><div class="line">                    &#123; id, text, <span class="attr">completed</span>: <span class="literal">false</span> &#125;,</div><div class="line">                ],</div><div class="line">            &#125;;</div><div class="line">        <span class="keyword">case</span> <span class="string">'TOGGLE_TODO'</span>:</div><div class="line">            <span class="keyword">return</span> &#123;</div><div class="line">                ...state,</div><div class="line">                <span class="attr">todos</span>: state.todos.map(<span class="function"><span class="params">todo</span> =&gt;</span> &#123;</div><div class="line">                    <span class="keyword">if</span> (todo.id !== action.id) <span class="keyword">return</span> todo;</div><div class="line">                    <span class="keyword">return</span> &#123;</div><div class="line">                        ...todo,</div><div class="line">                        <span class="attr">completed</span>: !todo.completed,</div><div class="line">                    &#125;;</div><div class="line">                &#125;),</div><div class="line">            &#125;;</div><div class="line">        <span class="keyword">case</span> <span class="string">'SET_VISIBILITY_FILTER'</span>:</div><div class="line">            <span class="keyword">return</span> &#123;</div><div class="line">                ...state,</div><div class="line">                <span class="attr">filter</span>: action.filter,</div><div class="line">            &#125;;</div><div class="line">        <span class="keyword">default</span>:</div><div class="line">            <span class="keyword">return</span> state;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>注意!<br>1.不要直接修改原有的 state，而是返回一个新的 state。可以使用 Object.assign() 新建一个新的 state。不能这样使用 Object.assign(state, { visibilityFilter: action.filter })，因为它会改变第一个参数的值。你必须把第一个参数设置为空对象。你也可以开启对 ES7 提案对象展开运算符的支持, 从而使用 { …state, …newState } 达到相同的目的。<br>2.在 default 的情况下返回旧的 state，用来兼容遇到未知的 action 这样的错误。</p>
</blockquote>
<p><strong>拆分 reducer</strong><br>目前代码看着比较冗长，其实在逻辑上 todos 的处理和 filter 的处理应该分开，所以在 state 没有互相耦合时，可以将其拆分，从而让 reducer 精细地对于对应 state 的子树进行处理。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 处理单个 todo</span></div><div class="line"><span class="keyword">const</span> todoReducer = <span class="function">(<span class="params">state, action</span>) =&gt;</span> &#123;</div><div class="line">    <span class="keyword">switch</span> (action.type) &#123;</div><div class="line">        <span class="keyword">case</span> <span class="string">'ADD_TODO'</span>:</div><div class="line">            <span class="keyword">return</span> &#123;</div><div class="line">                <span class="attr">id</span>: action.id,</div><div class="line">                <span class="attr">text</span>: action.text,</div><div class="line">                <span class="attr">completed</span>: <span class="literal">false</span>,</div><div class="line">            &#125;;</div><div class="line">        <span class="keyword">case</span> <span class="string">'TOGGLE_TODO'</span>:</div><div class="line">            <span class="keyword">if</span> (state.id !== action.id) <span class="keyword">return</span> state;</div><div class="line">            <span class="keyword">return</span> &#123;</div><div class="line">                ...state,</div><div class="line">                <span class="attr">completed</span>: !state.completed,</div><div class="line">            &#125;;</div><div class="line">        <span class="keyword">default</span>:</div><div class="line">            <span class="keyword">return</span> state;</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line"><span class="comment">// 处理 todos</span></div><div class="line"><span class="keyword">const</span> todosReducer = <span class="function">(<span class="params">state = [], action</span>) =&gt;</span> &#123;</div><div class="line">    <span class="keyword">switch</span> (action.type) &#123;</div><div class="line">        <span class="keyword">case</span> <span class="string">'ADD_TODO'</span>:</div><div class="line">            <span class="keyword">return</span> [</div><div class="line">                ...state,</div><div class="line">                todoReducer(<span class="literal">undefined</span>, action),</div><div class="line">            ];</div><div class="line">        <span class="keyword">case</span> <span class="string">'TOGGLE_TODO'</span>:</div><div class="line">            <span class="keyword">return</span> state.map(<span class="function"><span class="params">t</span> =&gt;</span> todoReducer(t, action));</div><div class="line">        <span class="keyword">default</span>:</div><div class="line">            <span class="keyword">return</span> state;</div><div class="line">    &#125;;</div><div class="line">&#125;;</div><div class="line"><span class="comment">// 处理 filter</span></div><div class="line"><span class="keyword">const</span> filterReducer = <span class="function">(<span class="params">state = <span class="string">'SHOW_ALL'</span>, action</span>) =&gt;</span> &#123;</div><div class="line">    <span class="keyword">switch</span> (action.type) &#123;</div><div class="line">        <span class="keyword">case</span> <span class="string">'SET_VISIBILITY_FILTER'</span>:</div><div class="line">            <span class="keyword">return</span> action.filter;</div><div class="line">        <span class="keyword">default</span>:</div><div class="line">            <span class="keyword">return</span> state;</div><div class="line">    &#125;;</div><div class="line">&#125;;</div><div class="line"><span class="keyword">const</span> rootReducer = <span class="function">(<span class="params">state = initialState, action</span>) =&gt;</span> (&#123;</div><div class="line">    <span class="attr">todos</span>: todosReducer(state.todos, action),</div><div class="line">    <span class="attr">filter</span>: filterReducer(state.filter, action),</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>注意观察最后的 rootReducer 函数，返回的是一个经过各种 reducer 处理过并合并后的新 state。</p>
<p>然鹅，注意这里 <code>todos: todos(state.todos, action)</code>, 传入 state.todos，返回的一定也是 todos（因为都是 state 树上的节点）。</p>
<p>所以 redux 提供了很实用的 <code>combineReducers</code> api，用于简化 reducer 的合并。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> &#123; combineReducers &#125; <span class="keyword">from</span> <span class="string">'redux'</span>;</div><div class="line"><span class="keyword">const</span> rootReducer = combineReducers(&#123;</div><div class="line">    <span class="attr">todos</span>: todosReducer,</div><div class="line">    <span class="attr">filter</span>: filterReducer,</div><div class="line">&#125;);</div><div class="line"><span class="comment">// initialState 可以作为第二个参数传入</span></div><div class="line"><span class="keyword">const</span> store = createStore(rootReducer, initialState);</div></pre></td></tr></table></figure>
<p>并且如果 reducer 与 state 节点同名的话（即 todosReducer -&gt; todos）还能通过 es6 的语法更进一步地简化<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> &#123; combineReducers &#125; <span class="keyword">from</span> <span class="string">'redux'</span>;</div><div class="line"><span class="keyword">const</span> rootReducer = combineReducers(&#123; todos, filter &#125;);</div><div class="line"><span class="comment">// initialState 可以作为第二个参数传入</span></div><div class="line"><span class="keyword">const</span> store = createStore(rootReducer, initialState);</div></pre></td></tr></table></figure></p>
<p>随着应用的膨胀，我们还可以将拆分后的 reducer 放到不同的文件中, 以保持其独立性并用于专门处理不同的数据域。</p>
<h4 id="3-view-部分"><a href="#3-view-部分" class="headerlink" title="3. view 部分"></a>3. view 部分</h4><p><strong>(1). 只有根组件</strong></p>
<p>首先只写一个根组件 <code>&lt;TodoApp/&gt;</code> ，store通过props传入TodoApp,并在生命周期的componentDidMount 和 componentWillUnmount时分别订阅与取消订阅</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">TodoApp</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</div><div class="line">    <span class="comment">// 订阅 store 的变化</span></div><div class="line">    componentDidMount() &#123;</div><div class="line">        <span class="keyword">const</span> &#123; store &#125; = <span class="keyword">this</span>.props;</div><div class="line">        <span class="keyword">this</span>.unsubscribe = store.subscribe(</div><div class="line">            <span class="keyword">this</span>.forceUpdate.bind(<span class="keyword">this</span>)</div><div class="line">        );</div><div class="line">    &#125;</div><div class="line">    <span class="comment">// 取消订阅</span></div><div class="line">    componentWillUnmount() &#123;</div><div class="line">        <span class="keyword">this</span>.unsubscribe();</div><div class="line">    &#125;</div><div class="line">    <span class="comment">// 渲染单个 todo</span></div><div class="line">    _renderTodo(todo) &#123;</div><div class="line">        <span class="keyword">const</span> &#123; store &#125; = <span class="keyword">this</span>.props;</div><div class="line">        <span class="keyword">return</span> (</div><div class="line">            &lt;li</div><div class="line">                key=&#123;todo.id&#125;</div><div class="line">                onClick=&#123;() =&gt; store.dispatch(toggleTodo(todo.id))&#125;</div><div class="line">                style=&#123;&#123;</div><div class="line">                    textDecoration: todo.completed</div><div class="line">                        ? 'line-through'</div><div class="line">                        : 'none',</div><div class="line">                    cursor: todo.completed</div><div class="line">                        ? 'default'</div><div class="line">                        : 'pointer',</div><div class="line">                &#125;&#125;</div><div class="line">            &gt;</div><div class="line">                &#123;todo.text&#125;</div><div class="line">            &lt;/li&gt;</div><div class="line">        );</div><div class="line">    &#125;</div><div class="line">    <span class="comment">// 根据当前 filter 是否匹配，返回字符串或是 a 链接</span></div><div class="line">    _renderFilter(renderFilter, name) &#123;</div><div class="line">        <span class="keyword">const</span> &#123; store &#125; = <span class="keyword">this</span>.props;</div><div class="line">        <span class="keyword">const</span> &#123; filter &#125; = store.getState();</div><div class="line">        <span class="keyword">if</span> (renderFilter === filter) <span class="keyword">return</span> name;</div><div class="line">        <span class="keyword">return</span> (</div><div class="line">            &lt;a href='#' onClick=&#123;e =&gt; &#123;</div><div class="line">                e.preventDefault();</div><div class="line">                store.dispatch(setVisibilityFilter(renderFilter))</div><div class="line">            &#125;&#125;&gt;</div><div class="line">                &#123;name&#125;</div><div class="line">            &lt;/a&gt;</div><div class="line">        );</div><div class="line">    &#125;</div><div class="line">    <span class="comment">// 根据当前 filter 过滤需要渲染的 todos</span></div><div class="line">    _getVisibleTodos(todos, filter) &#123;</div><div class="line">        <span class="keyword">switch</span> (filter) &#123;</div><div class="line">            <span class="keyword">case</span> <span class="string">'SHOW_ALL'</span>:</div><div class="line">                <span class="keyword">return</span> todos;</div><div class="line">            <span class="keyword">case</span> <span class="string">'SHOW_COMPLETED'</span>:</div><div class="line">                <span class="keyword">return</span> todos.filter(<span class="function"><span class="params">todo</span> =&gt;</span> todo.completed);</div><div class="line">            <span class="keyword">case</span> <span class="string">'SHOW_ACTIVE'</span>:</div><div class="line">                <span class="keyword">return</span> todos.filter(<span class="function"><span class="params">todo</span> =&gt;</span> !todo.completed);</div><div class="line">            <span class="keyword">default</span>:</div><div class="line">                <span class="keyword">return</span> todos;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    render() &#123;</div><div class="line">        <span class="keyword">const</span> &#123; store &#125; = <span class="keyword">this</span>.props;</div><div class="line">        <span class="keyword">const</span> &#123; todos, filter &#125; = store.getState();</div><div class="line">        <span class="keyword">let</span> input;</div><div class="line">        <span class="keyword">return</span> (</div><div class="line">            &lt;div&gt;</div><div class="line">                &#123;/* AddTodo */&#125;</div><div class="line">                &lt;input type="text" ref=&#123;node =&gt; input = node&#125; /&gt;</div><div class="line">                &lt;button onClick=&#123;() =&gt; &#123;</div><div class="line">                    if (!input.value) return;</div><div class="line">                    store.dispatch(addTodo(input.value));</div><div class="line">                    input.value = '';</div><div class="line">                &#125;&#125;&gt;</div><div class="line">                    addTodo</div><div class="line">                &lt;/button&gt;</div><div class="line">                &#123;/* TodoList */&#125;</div><div class="line">                &lt;ul&gt;</div><div class="line">                    &#123;this._getVisibleTodos(todos, filter)</div><div class="line">                        .map(this._renderTodo.bind(this))</div><div class="line">                    &#125;</div><div class="line">                &lt;/ul&gt;</div><div class="line">                &#123;/* Footer */&#125;</div><div class="line">                &lt;p&gt;</div><div class="line">                    Show:</div><div class="line">                    &#123;' '&#125;</div><div class="line">                    &#123;this._renderFilter('SHOW_ALL', 'all')&#125;</div><div class="line">                    &#123;', '&#125;</div><div class="line">                    &#123;this._renderFilter('SHOW_COMPLETED', 'completed')&#125;</div><div class="line">                    &#123;', '&#125;</div><div class="line">                    &#123;this._renderFilter('SHOW_ACTIVE', 'active')&#125;</div><div class="line">                &lt;/p&gt;</div><div class="line">            &lt;/div&gt;</div><div class="line">        );</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><strong>TodoApp 只有根组件</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 引入 createStore 方法</span></div><div class="line"><span class="keyword">const</span> &#123; createStore, combineReducers &#125; = Redux;</div><div class="line"><span class="keyword">const</span> &#123; Component &#125; = React;</div><div class="line"></div><div class="line"><span class="comment">// 暂且使用数字作为 id</span></div><div class="line"><span class="keyword">let</span> nextTodoId = <span class="number">0</span>;</div><div class="line"></div><div class="line"><span class="comment">/*-- action creators --*/</span></div><div class="line"><span class="keyword">const</span> addTodo = <span class="function">(<span class="params">text</span>) =&gt;</span> (</div><div class="line">    &#123; <span class="attr">type</span>: <span class="string">'ADD_TODO'</span>, <span class="attr">id</span>: nextTodoId++, text &#125;</div><div class="line">);</div><div class="line"></div><div class="line"><span class="keyword">const</span> toggleTodo = <span class="function">(<span class="params">id</span>) =&gt;</span> (</div><div class="line">    &#123; <span class="attr">type</span>: <span class="string">'TOGGLE_TODO'</span>, id &#125;</div><div class="line">);</div><div class="line"></div><div class="line"><span class="keyword">const</span> setVisibilityFilter = <span class="function">(<span class="params">filter</span>) =&gt;</span> (</div><div class="line">    &#123; <span class="attr">type</span>: <span class="string">'SET_VISIBILITY_FILTER'</span>, filter &#125;</div><div class="line">);</div><div class="line"></div><div class="line"><span class="comment">/*-- reducers --*/</span></div><div class="line"><span class="comment">// 默认初始状态</span></div><div class="line"><span class="keyword">const</span> initialState = &#123; <span class="attr">filter</span>: <span class="string">'SHOW_ALL'</span>, <span class="attr">todos</span>: [] &#125;;</div><div class="line"></div><div class="line"><span class="comment">// 处理单个 todo</span></div><div class="line"><span class="keyword">const</span> todo = <span class="function">(<span class="params">state, action</span>) =&gt;</span> &#123;</div><div class="line">    <span class="keyword">switch</span> (action.type) &#123;</div><div class="line">        <span class="keyword">case</span> <span class="string">'ADD_TODO'</span>:</div><div class="line">            <span class="keyword">return</span> &#123;</div><div class="line">                <span class="attr">id</span>: action.id,</div><div class="line">                <span class="attr">text</span>: action.text,</div><div class="line">                <span class="attr">completed</span>: <span class="literal">false</span>,</div><div class="line">            &#125;;</div><div class="line"></div><div class="line">        <span class="keyword">case</span> <span class="string">'TOGGLE_TODO'</span>:</div><div class="line">            <span class="keyword">if</span> (state.id !== action.id) <span class="keyword">return</span> state;</div><div class="line"></div><div class="line">            <span class="keyword">return</span> &#123;</div><div class="line">                ...state,</div><div class="line">                <span class="attr">completed</span>: !state.completed,</div><div class="line">            &#125;;</div><div class="line"></div><div class="line">        <span class="keyword">default</span>:</div><div class="line">            <span class="keyword">return</span> state;</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="comment">// 处理 todos</span></div><div class="line"><span class="keyword">const</span> todos = <span class="function">(<span class="params">state = [], action</span>) =&gt;</span> &#123;</div><div class="line">    <span class="keyword">switch</span> (action.type) &#123;</div><div class="line">        <span class="keyword">case</span> <span class="string">'ADD_TODO'</span>:</div><div class="line">            <span class="keyword">return</span> [</div><div class="line">                ...state,</div><div class="line">                todo(<span class="literal">undefined</span>, action),</div><div class="line">            ];</div><div class="line"></div><div class="line">        <span class="keyword">case</span> <span class="string">'TOGGLE_TODO'</span>:</div><div class="line">            <span class="keyword">return</span> state.map(<span class="function"><span class="params">t</span> =&gt;</span> todo(t, action));</div><div class="line"></div><div class="line">        <span class="keyword">default</span>:</div><div class="line">            <span class="keyword">return</span> state;</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="comment">// 处理 filter</span></div><div class="line"><span class="keyword">const</span> filter = <span class="function">(<span class="params">state = <span class="string">'SHOW_ALL'</span>, action</span>) =&gt;</span> &#123;</div><div class="line">    <span class="keyword">switch</span> (action.type) &#123;</div><div class="line">        <span class="keyword">case</span> <span class="string">'SET_VISIBILITY_FILTER'</span>:</div><div class="line">            <span class="keyword">return</span> action.filter;</div><div class="line"></div><div class="line">        <span class="keyword">default</span>:</div><div class="line">            <span class="keyword">return</span> state;</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="keyword">const</span> rootReducer = combineReducers(&#123; todos, filter &#125;);</div><div class="line"></div><div class="line"><span class="comment">/*-- view --*/</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">TodoApp</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</div><div class="line">    render() &#123;</div><div class="line">        <span class="keyword">const</span> &#123; store &#125; = <span class="keyword">this</span>.props;</div><div class="line">        <span class="keyword">const</span> &#123; todos, filter &#125; = store.getState();</div><div class="line"></div><div class="line">        <span class="keyword">let</span> input;</div><div class="line"></div><div class="line">        <span class="keyword">return</span> (</div><div class="line">            &lt;div&gt;</div><div class="line">                &#123;/* AddTodo */&#125;</div><div class="line">                &lt;input type="text" ref=&#123;node =&gt; input = node&#125; /&gt;</div><div class="line">                &lt;button onClick=&#123;() =&gt; &#123;</div><div class="line">                    if (!input.value) return;</div><div class="line"></div><div class="line">                    store.dispatch(addTodo(input.value));</div><div class="line">                    input.value = '';</div><div class="line">                &#125;&#125;&gt;</div><div class="line">                    addTodo</div><div class="line">                &lt;/button&gt;</div><div class="line"></div><div class="line">                &#123;/* TodoList */&#125;</div><div class="line">                &lt;ul&gt;</div><div class="line">                    &#123;</div><div class="line">                        this._getVisibleTodos(todos, filter)</div><div class="line">                            .map(this._renderTodo.bind(this))</div><div class="line">                    &#125;</div><div class="line">                &lt;/ul&gt;</div><div class="line"></div><div class="line">                &#123;/* Footer */&#125;</div><div class="line">                &lt;p&gt;</div><div class="line">                    Show:</div><div class="line">                    &#123;' '&#125;</div><div class="line">                    &#123;this._renderFilter('SHOW_ALL', 'all')&#125;</div><div class="line">                    &#123;', '&#125;</div><div class="line">                    &#123;this._renderFilter('SHOW_COMPLETED', 'completed')&#125;</div><div class="line">                    &#123;', '&#125;</div><div class="line">                    &#123;this._renderFilter('SHOW_ACTIVE', 'active')&#125;</div><div class="line">                &lt;/p&gt;</div><div class="line">            &lt;/div&gt;</div><div class="line">        );</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    // 订阅 store 的变化</div><div class="line">    componentDidMount() &#123;</div><div class="line">        const &#123; store &#125; = this.props;</div><div class="line"></div><div class="line">        this.unsubscribe = store.subscribe(</div><div class="line">            this.forceUpdate.bind(this)</div><div class="line">        );</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    // 取消订阅</div><div class="line">    componentWillUnmount() &#123;</div><div class="line">        this.unsubscribe();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    // 渲染单个 todo</div><div class="line">    _renderTodo(todo) &#123;</div><div class="line">        const &#123; store &#125; = this.props;</div><div class="line">        </div><div class="line">        return (</div><div class="line">            &lt;li</div><div class="line">                key=&#123;todo.id&#125;</div><div class="line">                onClick=&#123;() =&gt; store.dispatch(toggleTodo(todo.id))&#125;</div><div class="line">                style=&#123;&#123;</div><div class="line">                    textDecoration: todo.completed</div><div class="line">                        ? 'line-through'</div><div class="line">                        : 'none',</div><div class="line">                    cursor: todo.completed</div><div class="line">                        ? 'default'</div><div class="line">                        : 'pointer',</div><div class="line">                &#125;&#125;</div><div class="line">            &gt;</div><div class="line">                &#123;todo.text&#125;</div><div class="line">            &lt;/li&gt;</div><div class="line">        );</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    // 根据当前 filter 是否匹配，返回字符串或是 a 链接</div><div class="line">    _renderFilter(renderfilter, name) &#123;</div><div class="line">        const &#123; store &#125; = this.props;</div><div class="line">        const &#123; filter &#125; = store.getState();</div><div class="line"></div><div class="line">        if (renderfilter === filter) return name;</div><div class="line"></div><div class="line">        return (</div><div class="line">            &lt;a href='#' onClick=&#123;e =&gt; &#123;</div><div class="line">                e.preventDefault();</div><div class="line">                store.dispatch(setVisibilityFilter(renderfilter))</div><div class="line">            &#125;&#125;&gt;</div><div class="line">                &#123;name&#125;</div><div class="line">            &lt;/a&gt;</div><div class="line">        );</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    // 根据当前 filter 过滤需要渲染的 todos</div><div class="line">    _getVisibleTodos(todos, filter) &#123;</div><div class="line">        switch (filter) &#123;</div><div class="line">            case 'SHOW_ALL':</div><div class="line">                return todos;</div><div class="line"></div><div class="line">            case 'SHOW_COMPLETED':</div><div class="line">                return todos.filter(todo =&gt; todo.completed);</div><div class="line"></div><div class="line">            case 'SHOW_ACTIVE':</div><div class="line">                return todos.filter(todo =&gt; !todo.completed);</div><div class="line"></div><div class="line">            default:</div><div class="line">                return todos;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">/*-- ReactDOM 渲染部分 --*/</div><div class="line">ReactDOM.render(</div><div class="line">    &lt;TodoApp store=&#123;createStore(rootReducer, initialState)&#125; /&gt;,</div><div class="line">    document.getElementById('container'),</div><div class="line">);</div></pre></td></tr></table></figure>
<p><strong>(2).组件拆分</strong></p>
<p>将所有界面内容写在TodoApp中实在是太臃肿了，接下来根据之前的分析结果将其分为以下子组件（全是展示组件）</p>
<ul>
<li>AddTodo</li>
<li>TodoList<ul>
<li>Todo</li>
</ul>
</li>
<li>Footer<ul>
<li>FilterLink</li>
</ul>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> AddTodo = <span class="function">(<span class="params">&#123; onAddClick &#125;</span>) =&gt;</span> &#123;</div><div class="line">    <span class="keyword">let</span> input;</div><div class="line">    <span class="keyword">return</span> (</div><div class="line">        &lt;div&gt;</div><div class="line">            &lt;input type="text" ref=&#123;node =&gt; input = node&#125; /&gt;</div><div class="line">            &lt;button onClick=&#123;() =&gt; &#123;</div><div class="line">                onAddClick(input.value);</div><div class="line">                input.value = '';</div><div class="line">            &#125;&#125;&gt;</div><div class="line">                addTodo</div><div class="line">            &lt;/button&gt;</div><div class="line">        &lt;/div&gt;</div><div class="line">    );</div><div class="line">&#125;;</div><div class="line"></div><div class="line">const Todo = (&#123; text, onClick, completed &#125;) =&gt; (</div><div class="line">    &lt;li</div><div class="line">        onClick=&#123;onClick&#125;</div><div class="line">        style=&#123;&#123;</div><div class="line">            textDecoration: completed</div><div class="line">                ? 'line-through'</div><div class="line">                : 'none',</div><div class="line">            cursor: completed</div><div class="line">                ? 'default'</div><div class="line">                : 'pointer',</div><div class="line">        &#125;&#125;</div><div class="line">    &gt;</div><div class="line">        &#123;text&#125;</div><div class="line">    &lt;/li&gt;</div><div class="line">);</div><div class="line"></div><div class="line">const TodoList = (&#123; todos, onTodoClick &#125;) =&gt; (</div><div class="line">    &lt;ul&gt;</div><div class="line">        &#123;todos.map(todo =&gt;</div><div class="line">            &lt;Todo</div><div class="line">                key=&#123;todo.id&#125;</div><div class="line">                &#123;...todo&#125;</div><div class="line">                onClick=&#123;() =&gt; onTodoClick(todo.id)&#125;</div><div class="line">            /&gt;</div><div class="line">        )&#125;</div><div class="line">    &lt;/ul&gt;</div><div class="line">);</div><div class="line"></div><div class="line">const FilterLink = (&#123; filter, onClick, renderFilter, children &#125;) =&gt; &#123;</div><div class="line">    if (renderFilter === filter) return (&lt;span&gt;&#123;children&#125;&lt;/span&gt;);</div><div class="line">    return (</div><div class="line">        &lt;a href='#' onClick=&#123;e =&gt; &#123;</div><div class="line">            e.preventDefault();</div><div class="line">            onClick(renderFilter);</div><div class="line">        &#125;&#125;&gt;</div><div class="line">            &#123;children&#125;</div><div class="line">        &lt;/a&gt;</div><div class="line">    );</div><div class="line">&#125;;</div><div class="line"></div><div class="line">const Footer = (&#123; filter, onFilterClick &#125;) =&gt; (</div><div class="line">    &lt;p&gt;</div><div class="line">        Show:</div><div class="line">        &#123;' '&#125;</div><div class="line">        &lt;FilterLink</div><div class="line">            filter=&#123;filter&#125;</div><div class="line">            renderFilter="SHOW_ALL"</div><div class="line">            onClick=&#123;onFilterClick&#125;</div><div class="line">        &gt;</div><div class="line">            all</div><div class="line">        &lt;/FilterLink&gt;</div><div class="line">        &#123;', '&#125;</div><div class="line">        &lt;FilterLink</div><div class="line">            filter=&#123;filter&#125;</div><div class="line">            renderFilter="SHOW_COMPLETED"</div><div class="line">            onClick=&#123;onFilterClick&#125;</div><div class="line">        &gt;</div><div class="line">            completed</div><div class="line">        &lt;/FilterLink&gt;</div><div class="line">        &#123;', '&#125;</div><div class="line">        &lt;FilterLink</div><div class="line">            filter=&#123;filter&#125;</div><div class="line">            renderFilter="SHOW_ACTIVE"</div><div class="line">            onClick=&#123;onFilterClick&#125;</div><div class="line">        &gt;</div><div class="line">            active</div><div class="line">        &lt;/FilterLink&gt;</div><div class="line">    &lt;/p&gt;</div><div class="line">);</div></pre></td></tr></table></figure>
<p>所以 TodoApp 精简后是这样~</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">TodoApp</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</div><div class="line">    <span class="comment">// ...</span></div><div class="line">    render() &#123;</div><div class="line">        <span class="keyword">const</span> &#123; store &#125; = <span class="keyword">this</span>.props;</div><div class="line">        <span class="keyword">const</span> &#123; todos, filter &#125; = store.getState();</div><div class="line">        <span class="keyword">return</span> (</div><div class="line">            &lt;div&gt;</div><div class="line">                &lt;AddTodo</div><div class="line">                    onAddClick=&#123;text =&gt; &#123;</div><div class="line">                        if (!text) return;</div><div class="line">                        store.dispatch(addTodo(text));</div><div class="line">                    &#125;&#125;</div><div class="line">                /&gt;</div><div class="line">                &lt;TodoList</div><div class="line">                    todos=&#123;this._getVisibleTodos(todos, filter)&#125;</div><div class="line">                    onTodoClick=&#123;id =&gt; store.dispatch(toggleTodo(id))&#125;</div><div class="line">                /&gt;</div><div class="line">                &lt;Footer</div><div class="line">                    filter=&#123;filter&#125;</div><div class="line">                    onFilterClick=&#123;filter =&gt; &#123;</div><div class="line">                        store.dispatch(setVisibilityFilter(filter));</div><div class="line">                    &#125;&#125;</div><div class="line">                /&gt;</div><div class="line">            &lt;/div&gt;</div><div class="line">        );</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><strong>(3). 增加容器组件</strong></p>
<p>现在我们仍然是以 TodoApp 作为容器组件，其中各个子组件都是展示组件。</p>
<p>但是这样做的话一旦子组件需要某个属性，就需要从根组件层层传递下来，比如 FilterLink 中的 filter 属性。</p>
<p>所以下面我们增加容器组件，让展示组件通过容器组件获得所需属性。</p>
<ul>
<li>AddTodo(container)</li>
<li>VisibleTodoList(container)<ul>
<li>TodoList</li>
<li>Todo</li>
</ul>
</li>
<li>Footer<ul>
<li>FilterLink(container)<ul>
<li>Link</li>
</ul>
</li>
</ul>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// store.dispatch 又被放回来了，</span></div><div class="line"><span class="comment">// 因为暂时我们只在 AddTodo 组件中使用 addTodo 这个 action</span></div><div class="line"><span class="comment">// 以后增加了新的 form 之后可以考虑再将 store.dispatch 移出去</span></div><div class="line"><span class="keyword">const</span> AddTodo = <span class="function">(<span class="params">&#123; store &#125;</span>) =&gt;</span> &#123;</div><div class="line">    <span class="keyword">let</span> input;</div><div class="line">    <span class="keyword">return</span> (</div><div class="line">        &lt;div&gt;</div><div class="line">            &lt;input type="text" ref=&#123;node =&gt; input = node&#125; /&gt;</div><div class="line">            &lt;button onClick=&#123;() =&gt; &#123;</div><div class="line">                if (!input.value) return;</div><div class="line">                store.dispatch(addTodo(input.value));</div><div class="line">                input.value = '';</div><div class="line">            &#125;&#125;&gt;</div><div class="line">                addTodo</div><div class="line">            &lt;/button&gt;</div><div class="line">        &lt;/div&gt;</div><div class="line">    );</div><div class="line">&#125;;</div><div class="line"></div><div class="line">const Todo = (&#123; text, onClick, completed &#125;) =&gt; (</div><div class="line">    &lt;li</div><div class="line">        onClick=&#123;onClick&#125;</div><div class="line">        style=&#123;&#123;</div><div class="line">            textDecoration: completed</div><div class="line">                ? 'line-through'</div><div class="line">                : 'none',</div><div class="line">            cursor: completed</div><div class="line">                ? 'default'</div><div class="line">                : 'pointer',</div><div class="line">        &#125;&#125;</div><div class="line">    &gt;</div><div class="line">        &#123;text&#125;</div><div class="line">    &lt;/li&gt;</div><div class="line">);</div><div class="line"></div><div class="line">const TodoList = (&#123; todos, onTodoClick &#125;) =&gt; (</div><div class="line">    &lt;ul&gt;</div><div class="line">        &#123;todos.map(todo =&gt;</div><div class="line">            &lt;Todo</div><div class="line">                key=&#123;todo.id&#125;</div><div class="line">                &#123;...todo&#125;</div><div class="line">                onClick=&#123;() =&gt; onTodoClick(todo.id)&#125;</div><div class="line">            /&gt;</div><div class="line">        )&#125;</div><div class="line">    &lt;/ul&gt;</div><div class="line">);</div><div class="line">// 容器组件</div><div class="line">class VisibleTodoList extends Component &#123;</div><div class="line">    // 订阅 store 的变化</div><div class="line">    componentDidMount() &#123;</div><div class="line">        const &#123; store &#125; = this.props;</div><div class="line">        this.unsubscribe = store.subscribe(</div><div class="line">            this.forceUpdate.bind(this)</div><div class="line">        );</div><div class="line">    &#125;</div><div class="line">    </div><div class="line"> </div><div class="line">    // 取消订阅</div><div class="line">    componentWillUnmount() &#123;</div><div class="line">        this.unsubscribe();</div><div class="line">    &#125;</div><div class="line">    // 根据当前 filter 过滤需要渲染的 todos</div><div class="line">    _getVisibleTodos(todos, filter) &#123;</div><div class="line">        switch (filter) &#123;</div><div class="line">            case 'SHOW_ALL':</div><div class="line">                return todos;</div><div class="line">            case 'SHOW_COMPLETED':</div><div class="line">                return todos.filter(todo =&gt; todo.completed);</div><div class="line">            case 'SHOW_ACTIVE':</div><div class="line">                return todos.filter(todo =&gt; !todo.completed);</div><div class="line">            default:</div><div class="line">                return todos;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    render() &#123;</div><div class="line">        const &#123; store &#125; = this.props;</div><div class="line">        const &#123; todos, filter &#125; = store.getState();</div><div class="line">        return (</div><div class="line">            &lt;TodoList</div><div class="line">                todos=&#123;this._getVisibleTodos(todos, filter)&#125;</div><div class="line">                onTodoClick=&#123;id =&gt; &#123;</div><div class="line">                    store.dispatch(toggleTodo(id))</div><div class="line">                &#125;&#125;</div><div class="line">            /&gt;</div><div class="line">        );</div><div class="line">    &#125;</div><div class="line">&#125;   </div><div class="line"></div><div class="line"></div><div class="line">// 原本的 FilterLink 改成 Link，去掉 filter 和 renderFilter 属性，改为传入 active</div><div class="line">const Link = (&#123; active, onClick, children &#125;) =&gt; &#123;</div><div class="line">    if (active) return (&lt;span&gt;&#123;children&#125;&lt;/span&gt;);</div><div class="line">    return (</div><div class="line">        &lt;a href='#' onClick=&#123;e =&gt; &#123;</div><div class="line">            e.preventDefault();</div><div class="line">            onClick();</div><div class="line">        &#125;&#125;&gt;</div><div class="line">            &#123;children&#125;</div><div class="line">        &lt;/a&gt;</div><div class="line">    );</div><div class="line">&#125;;</div><div class="line">// 容器组件</div><div class="line">class FilterLink extends Component &#123;</div><div class="line">    // 订阅 store 的变化</div><div class="line">    componentDidMount() &#123;</div><div class="line">        const &#123; store &#125; = this.props;</div><div class="line">        this.unsubscribe = store.subscribe(</div><div class="line">            this.forceUpdate.bind(this)</div><div class="line">        );</div><div class="line">    &#125;</div><div class="line">    // 取消订阅</div><div class="line">    componentWillUnmount() &#123;</div><div class="line">        this.unsubscribe();</div><div class="line">    &#125;</div><div class="line">    render() &#123;</div><div class="line">        const &#123; store, renderFilter, children &#125; = this.props;</div><div class="line">        const &#123; filter &#125; = store.getState();</div><div class="line">        return (</div><div class="line">            &lt;Link</div><div class="line">                active=&#123;filter === renderFilter&#125;</div><div class="line">                onClick=&#123;() =&gt; store.dispatch(</div><div class="line">                    setVisibilityFilter(renderFilter)</div><div class="line">                )&#125;</div><div class="line">            &gt;</div><div class="line">                &#123;children&#125;</div><div class="line">            &lt;/Link&gt;</div><div class="line">        );</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">// 展示组件</div><div class="line">const Footer = (&#123; store &#125;) =&gt; (</div><div class="line">    &lt;p&gt;</div><div class="line">        Show:</div><div class="line">        &#123;' '&#125;</div><div class="line">        &lt;FilterLink</div><div class="line">            store=&#123;store&#125;</div><div class="line">            renderFilter="SHOW_ALL"</div><div class="line">        &gt;</div><div class="line">            all</div><div class="line">        &lt;/FilterLink&gt;</div><div class="line">        &#123;', '&#125;</div><div class="line">        &lt;FilterLink</div><div class="line">            store=&#123;store&#125;</div><div class="line">            renderFilter="SHOW_COMPLETED"</div><div class="line">        &gt;</div><div class="line">            completed</div><div class="line">        &lt;/FilterLink&gt;</div><div class="line">        &#123;', '&#125;</div><div class="line">        &lt;FilterLink</div><div class="line">            store=&#123;store&#125;</div><div class="line">            renderFilter="SHOW_ACTIVE"</div><div class="line">        &gt;</div><div class="line">            active</div><div class="line">        &lt;/FilterLink&gt;</div><div class="line">    &lt;/p&gt;</div><div class="line">);</div><div class="line">// 在不使用全局变量 store 的情况下，</div><div class="line">// 暂时只能通过 props 传递进来，</div><div class="line">// Don't worry~很快就不会这么麻烦了~</div><div class="line">const TodoApp = (&#123; store &#125;) =&gt; (</div><div class="line">    &lt;div&gt;</div><div class="line">        &lt;AddTodo store=&#123;store&#125; /&gt;</div><div class="line">        &lt;VisibleTodoList store=&#123;store&#125; /&gt;</div><div class="line">        &lt;Footer store=&#123;store&#125; /&gt;</div><div class="line">    &lt;/div&gt;</div><div class="line">);</div></pre></td></tr></table></figure>
<p><strong>通过观察重构后的代码可以发现有三点麻烦的地方</strong></p>
<ol>
<li>根组件需要通过 props 将 store 传给各个子组件</li>
<li>容器组件都要定义 componentDidMount 进行订阅和 componentWillUnmount 取消订阅</li>
<li>应用其实并不需要渲染所有的 todos，所以内部很麻烦地定义了 <code>_getVisibleTodos</code> 函数</li>
</ol>
<p><strong>(4). Provider</strong></p>
<p>让我们先来解决第一个麻烦~，利用 React 提供的 <a href="http://facebook.github.io/react/docs/context.html" target="_blank" rel="external">context 特性</a></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Provider</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</div><div class="line">    <span class="comment">// 通过该方法向 children 的 context 注入 store</span></div><div class="line">    getChildContext() &#123;</div><div class="line">        <span class="keyword">return</span> &#123; <span class="attr">store</span>: <span class="keyword">this</span>.props.store &#125;;</div><div class="line">    &#125;</div><div class="line">    render() &#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.props.children;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="comment">// 必须要声明传入 context 的 store 的类型</span></div><div class="line">Provider.childContextTypes = &#123;</div><div class="line">    <span class="attr">store</span>: React.PropTypes.object,</div><div class="line">&#125;;</div><div class="line"><span class="string">``</span><span class="string">`    </span></div><div class="line">自顶向下地看以下如何使用到TodoApp中</div><div class="line"></div><div class="line">`<span class="string">``</span> javascript</div><div class="line"><span class="comment">// 1. 使用 Provider 包裹 TodoApp，并将 store 作为 props 传入</span></div><div class="line">ReactDOM.render(</div><div class="line">    &lt;Provider store=&#123;createStore(rootReducer, initialState)&#125;&gt;</div><div class="line">        &lt;TodoApp /&gt;</div><div class="line">    &lt;/Provider&gt;,</div><div class="line">    <span class="built_in">document</span>.getElementById(<span class="string">'container'</span>),</div><div class="line">);</div><div class="line"><span class="comment">// 2. 根组件 TodoApp: 和 store say goodbye~，</span></div><div class="line"><span class="comment">// 因为 TodoApp 并不是容器组件~</span></div><div class="line"><span class="keyword">const</span> TodoApp = <span class="function"><span class="params">()</span> =&gt;</span> (</div><div class="line">    &lt;div&gt;</div><div class="line">        &lt;AddTodo /&gt;</div><div class="line">        &lt;VisibleTodoList /&gt;</div><div class="line">        &lt;Footer /&gt;</div><div class="line">    &lt;/div&gt;</div><div class="line">);</div><div class="line"><span class="comment">// 3. AddTodo: 由于 props 固定作为第一个传入子组件的参数，</span></div><div class="line"><span class="comment">// 所以 &#123; store &#125; 要声明在第二位，然鹅需要声明 contextTypes...</span></div><div class="line"><span class="keyword">const</span> AddTodo = <span class="function">(<span class="params">props, &#123; store &#125;</span>) =&gt;</span> &#123;</div><div class="line">    <span class="comment">// ...</span></div><div class="line">&#125;;</div><div class="line"><span class="comment">// 必须声明</span></div><div class="line">AddTodo.contextTypes = &#123;</div><div class="line">    <span class="attr">store</span>: React.PropTypes.object,</div><div class="line">&#125;;</div><div class="line"><span class="comment">// 4. VisibleTodoList: 从 props 改成从 context 中获取 store，</span></div><div class="line"><span class="comment">// 同样声明 contextTypes...</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">VisibleTodoList</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</div><div class="line">    <span class="comment">// 订阅 store 的变化</span></div><div class="line">    componentDidMount() &#123;</div><div class="line">        <span class="keyword">const</span> &#123; store &#125; = <span class="keyword">this</span>.context; <span class="comment">// props -&gt; context</span></div><div class="line">        <span class="comment">// ...</span></div><div class="line">    &#125;</div><div class="line">    <span class="comment">// ...</span></div><div class="line">    render() &#123;</div><div class="line">        <span class="keyword">const</span> &#123; store &#125; = <span class="keyword">this</span>.context; <span class="comment">// props -&gt; context</span></div><div class="line">        <span class="keyword">const</span> &#123; todos, filter &#125; = store.getState();</div><div class="line">        <span class="comment">// ...</span></div><div class="line">    &#125;</div><div class="line">&#125;    </div><div class="line">    </div><div class="line"><span class="comment">// 必须声明</span></div><div class="line">VisibleTodoList.contextTypes = &#123;</div><div class="line">    <span class="attr">store</span>: React.PropTypes.object,</div><div class="line">&#125;;</div><div class="line"><span class="comment">// -- TodoList 和 Todo 不变 --</span></div><div class="line"><span class="comment">// 5. Footer：和 store say goodbye...</span></div><div class="line"><span class="keyword">const</span> Footer = <span class="function"><span class="params">()</span> =&gt;</span> (</div><div class="line">    &lt;p&gt;</div><div class="line">        Show:</div><div class="line">        &#123;' '&#125;</div><div class="line">        &lt;FilterLink renderFilter="SHOW_ALL"&gt;</div><div class="line">            all</div><div class="line">        &lt;/FilterLink&gt;</div><div class="line">        &#123;', '&#125;</div><div class="line">        &lt;FilterLink renderFilter="SHOW_COMPLETED"&gt;</div><div class="line">            completed</div><div class="line">        &lt;/FilterLink&gt;</div><div class="line">        &#123;', '&#125;</div><div class="line">        &lt;FilterLink renderFilter="SHOW_ACTIVE"&gt;</div><div class="line">            active</div><div class="line">        &lt;/FilterLink&gt;</div><div class="line">    &lt;/p&gt;</div><div class="line">);</div><div class="line"><span class="comment">// 6. FilterLink: 同 VisibleTodoList（props + contextTypes...）</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">FilterLink</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</div><div class="line">    <span class="comment">// 订阅 store 的变化</span></div><div class="line">    componentDidMount() &#123;</div><div class="line">        <span class="keyword">const</span> &#123; store &#125; = <span class="keyword">this</span>.context; <span class="comment">// props -&gt; context</span></div><div class="line">        <span class="comment">// ...</span></div><div class="line">    &#125;</div><div class="line">    <span class="comment">// ...</span></div><div class="line">    render() &#123;</div><div class="line">        <span class="keyword">const</span> &#123; renderFilter, children &#125; = <span class="keyword">this</span>.props;</div><div class="line">        <span class="keyword">const</span> &#123; store &#125; = <span class="keyword">this</span>.context; <span class="comment">// props -&gt; context</span></div><div class="line">        <span class="keyword">const</span> &#123; filter &#125; = store.getState();</div><div class="line">        <span class="comment">// ...</span></div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line">    </div><div class="line">    </div><div class="line"><span class="comment">// 必须声明</span></div><div class="line">FilterLink.contextTypes = &#123;</div><div class="line">    <span class="attr">store</span>: React.PropTypes.object,</div><div class="line">&#125;;</div><div class="line"><span class="comment">// -- Link 不变 --</span></div></pre></td></tr></table></figure>
<p><strong>现在中间的非容器组件完全不用为了自己的孩子而费劲地传递 store={store}</strong><br>所以以上我们就实现了简化版的由 react-redux 提供的第一个组件 <code>&lt;Provider /&gt;</code>。</p>
<p>然鹅，有木有觉得老写 contextTypes 好烦啊，而且 context 特性并不稳定，所以 context 并不应该直接写在我们的应用代码里。</p>
<blockquote>
<p>计将安出？</p>
</blockquote>
<p><strong>5. connect</strong></p>
<p>-OOP思维：这还不简单？写个函数把容器组件传进去作为父类，然后返回写好了 componentDidMount，componentWillUnmount 和 contextTypes 的子类不就好啦~ </p>
<p>恭喜你~面向对象的思想学的很不错~</p>
<p>虽然 JavaScript 底层各种东西都是面向对象，然而在前端一旦与界面相关，照搬面向对象的方法实现起来会很麻烦…</p>
<p>React 早期用户：这还不简单？写个 mixin 岂不美哉~~？<br>作为 react 亲生的 mixin 确实在多组件间共享方法提供了一些便利，然而使用 mixin 的组件需要了解细节，从而避免状态污染，所以一旦 mixin 数量多了之后会越来越难维护。</p>
<blockquote>
<p>Unfortunately, we will not launch any mixin support for ES6 classes in React. That would defeat the purpose of only using idiomatic JavaScript concepts.</p>
</blockquote>
<p>所以官方也放弃了在 ES6 class 中对 mixin 的支持。</p>
<p>函数式（FP）：高阶组件 High Order Component（下称 hoc）才是终极解决方案~~</p>
<p>hocFactory:: W: React.Component =&gt; E: React.Component</p>
<p>如上所示 hoc 的构造函数接收一个 W（代表 WrappedComponent）返回一个 E（代表 Enhanced Component），而 E 就是这个高阶组件。   </p>
<p> 假设我们有一个旧组件 Comp，然鹅现在接收参数有些变动。</p>
<p> 当然你可以复制粘贴再修改旧组件的代码…（大侠受窝一拜）</p>
<p> 也可以这么写，返回一个新组件来包裹旧组件。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">NewComp</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</div><div class="line">    mapProps(props) &#123;</div><div class="line">        <span class="keyword">return</span> &#123;<span class="comment">/* new props */</span>&#125;;</div><div class="line">    &#125;</div><div class="line">    render() &#123;</div><div class="line">        <span class="keyword">return</span> (&lt;Comp &#123;...this.mapProps(this.props)&#125; /&gt;);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>然鹅，如果有同样逻辑的更多的组件需要适配呢？？？总不能有几个抄几遍吧…</p>
<p><strong>所以骚年你听说过高阶组件么~？</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div></pre></td><td class="code"><pre><div class="line"> <span class="comment">// 先返回一个函数，而那个函数再返回新组件</span></div><div class="line"> <span class="keyword">const</span> mapProps = <span class="function"><span class="params">mapFn</span> =&gt;</span> Comp =&gt; &#123;</div><div class="line">     <span class="keyword">return</span> <span class="class"><span class="keyword">class</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</div><div class="line">         render() &#123;</div><div class="line">             <span class="keyword">return</span> (&lt;Comp &#123;...this.mapFn(this.props)&#125; /&gt;);</div><div class="line">         &#125;</div><div class="line">     &#125;;</div><div class="line"> &#125;;</div><div class="line"> const NewComp = mapProps(mapFn)(Comp); // 注意调用了两次</div><div class="line">``` </div><div class="line"> </div><div class="line">可以看到借助高阶组件我们将 mapFn 和 Comp 解耦合，这样就算需要再嵌套多少修改逻辑都没问题~~天黑都不怕~~</div><div class="line"></div><div class="line">**ok,扯了这么多得淡，终于要说到connect了**</div><div class="line"></div><div class="line">是哒，你木有猜错，react-redux 提供的第二个也是最后一个 api —— connect 返回的就是一个高阶组件。</div><div class="line"></div><div class="line">使用的时候只需要 `connect()(WrappedComponent)` 返回的 component 自动就完成了在 componentDidMount 中订阅 store，在 componentWillUnmount 中取消订阅和声明 contextTypes。</div><div class="line"></div><div class="line">**这样就只剩下最后一个麻烦**</div><div class="line">    </div><div class="line">&gt; 应用其实并不需要渲染所有的 todos，所以内部很麻烦地定义了 `_getVisibleTodos` 函数</div><div class="line"></div><div class="line">其实 connect 函数的第一个参数叫做 mapStateToProps，作用就是将 store 中的数据提前处理或过滤后作为 props 传入内部组件，以便内部组件高效地直接调用。这样最后一个麻烦也解决了~</div><div class="line"></div><div class="line">**然鹅，我们问自己这样就够了么？并没有…**</div><div class="line"></div><div class="line">还有最后一个细节，以 FilterLink 为例。    </div><div class="line"></div><div class="line">``` javascript</div><div class="line">class FilterLink extends Component &#123;</div><div class="line">    // ...</div><div class="line">    render() &#123;</div><div class="line">        const &#123; store, renderFilter, children &#125; = this.props;</div><div class="line">        const &#123; filter &#125; = store.getState();</div><div class="line">        return (</div><div class="line">            &lt;Link</div><div class="line">                active=&#123;filter === renderFilter&#125;</div><div class="line">                onClick=&#123;() =&gt; store.dispatch(</div><div class="line">                    setVisibilityFilter(renderFilter)</div><div class="line">                )&#125;</div><div class="line">            &gt;</div><div class="line">                &#123;children&#125;</div><div class="line">            &lt;/Link&gt;</div><div class="line">        );</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>除了从 store 中获取数据（filter），我们还从中获取了 dispatch，以便触发 action。如果将回调函数 onClick 的内容也加到 props 中，那么借助 connect 整个 FilterLink 的逻辑岂不是都被我们抽象完了？</p>
<p>是哒，connect 的第二个参数叫做 mapDispatchToProps，作用就是将各个调用到 dispatch 的地方都抽象成函数加到 props 中的传给内部组件。这样最后一个麻烦终于真的被解决了~</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> mapStateToLinkProps = <span class="function">(<span class="params">state, ownProps</span>) =&gt;</span> (&#123;</div><div class="line">    <span class="comment">// ownProps 是原组件的 props，</span></div><div class="line">    <span class="comment">// 这里为了和高阶组件的 props 区分</span></div><div class="line">    active: ownProps.renderFilter === state.filter,</div><div class="line">&#125;);</div><div class="line"><span class="keyword">const</span> mapDispatchToLinkProps = <span class="function">(<span class="params">dispatch, ownProps</span>) =&gt;</span> (&#123;</div><div class="line">    onClick() &#123;</div><div class="line">        dispatch(</div><div class="line">            setVisibilityFilter(ownProps.renderFilter)</div><div class="line">        );</div><div class="line">    &#125;,</div><div class="line">&#125;);</div><div class="line"><span class="comment">// 注意原 FilterLink 整个都被我们删了</span></div><div class="line"><span class="keyword">const</span> FilterLink = connect(</div><div class="line">    mapStateToLinkProps,</div><div class="line">    mapDispatchToLinkProps</div><div class="line">)(Link);</div></pre></td></tr></table></figure>
<p><strong>TodoApp 使用react-redux</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 引入 createStore 方法</span></div><div class="line"><span class="keyword">const</span> &#123; createStore, combineReducers &#125; = Redux;</div><div class="line"><span class="keyword">const</span> &#123; Provider, connect &#125; = ReactRedux;</div><div class="line"></div><div class="line"><span class="comment">// 暂且使用数字作为 id</span></div><div class="line"><span class="keyword">let</span> nextTodoId = <span class="number">0</span>;</div><div class="line"></div><div class="line"><span class="comment">/*-- action creators --*/</span></div><div class="line"><span class="keyword">const</span> addTodo = <span class="function">(<span class="params">text</span>) =&gt;</span> (</div><div class="line">    &#123; <span class="attr">type</span>: <span class="string">'ADD_TODO'</span>, <span class="attr">id</span>: nextTodoId++, text &#125;</div><div class="line">);</div><div class="line"></div><div class="line"><span class="keyword">const</span> toggleTodo = <span class="function">(<span class="params">id</span>) =&gt;</span> (</div><div class="line">    &#123; <span class="attr">type</span>: <span class="string">'TOGGLE_TODO'</span>, id &#125;</div><div class="line">);</div><div class="line"></div><div class="line"><span class="keyword">const</span> setVisibilityFilter = <span class="function">(<span class="params">filter</span>) =&gt;</span> (</div><div class="line">    &#123; <span class="attr">type</span>: <span class="string">'SET_VISIBILITY_FILTER'</span>, filter &#125;</div><div class="line">);</div><div class="line"></div><div class="line"><span class="comment">/*-- reducers --*/</span></div><div class="line"><span class="comment">// 默认初始状态</span></div><div class="line"><span class="keyword">const</span> initialState = &#123; <span class="attr">filter</span>: <span class="string">'SHOW_ALL'</span>, <span class="attr">todos</span>: [] &#125;;</div><div class="line"></div><div class="line"><span class="comment">// 处理单个 todo</span></div><div class="line"><span class="keyword">const</span> todo = <span class="function">(<span class="params">state, action</span>) =&gt;</span> &#123;</div><div class="line">    <span class="keyword">switch</span> (action.type) &#123;</div><div class="line">        <span class="keyword">case</span> <span class="string">'ADD_TODO'</span>:</div><div class="line">            <span class="keyword">return</span> &#123;</div><div class="line">                <span class="attr">id</span>: action.id,</div><div class="line">                <span class="attr">text</span>: action.text,</div><div class="line">                <span class="attr">completed</span>: <span class="literal">false</span>,</div><div class="line">            &#125;;</div><div class="line"></div><div class="line">        <span class="keyword">case</span> <span class="string">'TOGGLE_TODO'</span>:</div><div class="line">            <span class="keyword">if</span> (state.id !== action.id) <span class="keyword">return</span> state;</div><div class="line"></div><div class="line">            <span class="keyword">return</span> &#123;</div><div class="line">                ...state,</div><div class="line">                <span class="attr">completed</span>: !state.completed,</div><div class="line">            &#125;;</div><div class="line"></div><div class="line">        <span class="keyword">default</span>:</div><div class="line">            <span class="keyword">return</span> state;</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="comment">// 处理 todos</span></div><div class="line"><span class="keyword">const</span> todos = <span class="function">(<span class="params">state = [], action</span>) =&gt;</span> &#123;</div><div class="line">    <span class="keyword">switch</span> (action.type) &#123;</div><div class="line">        <span class="keyword">case</span> <span class="string">'ADD_TODO'</span>:</div><div class="line">            <span class="keyword">return</span> [</div><div class="line">                ...state,</div><div class="line">                todo(<span class="literal">undefined</span>, action),</div><div class="line">            ];</div><div class="line"></div><div class="line">        <span class="keyword">case</span> <span class="string">'TOGGLE_TODO'</span>:</div><div class="line">            <span class="keyword">return</span> state.map(<span class="function"><span class="params">t</span> =&gt;</span> todo(t, action));</div><div class="line"></div><div class="line">        <span class="keyword">default</span>:</div><div class="line">            <span class="keyword">return</span> state;</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="comment">// 处理 filter</span></div><div class="line"><span class="keyword">const</span> filter = <span class="function">(<span class="params">state = <span class="string">'SHOW_ALL'</span>, action</span>) =&gt;</span> &#123;</div><div class="line">    <span class="keyword">switch</span> (action.type) &#123;</div><div class="line">        <span class="keyword">case</span> <span class="string">'SET_VISIBILITY_FILTER'</span>:</div><div class="line">            <span class="keyword">return</span> action.filter;</div><div class="line"></div><div class="line">        <span class="keyword">default</span>:</div><div class="line">            <span class="keyword">return</span> state;</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="keyword">const</span> rootReducer = combineReducers(&#123; todos, filter &#125;);</div><div class="line"></div><div class="line"><span class="comment">/*-- view --*/</span></div><div class="line"><span class="comment">// dispatch 作为 props 被传入</span></div><div class="line"><span class="keyword">let</span> AddTodo = <span class="function">(<span class="params">&#123; dispatch &#125;</span>) =&gt;</span> &#123;</div><div class="line">    <span class="keyword">let</span> input;</div><div class="line"></div><div class="line">    <span class="keyword">return</span> (</div><div class="line">        &lt;div&gt;</div><div class="line">            &lt;input type="text" ref=&#123;node =&gt; input = node&#125; /&gt;</div><div class="line">            &lt;button onClick=&#123;() =&gt; &#123;</div><div class="line">                if (!input.value) return;</div><div class="line"></div><div class="line">                dispatch(addTodo(input.value));</div><div class="line">                input.value = '';</div><div class="line">            &#125;&#125;&gt;</div><div class="line">                addTodo</div><div class="line">            &lt;/button&gt;</div><div class="line">        &lt;/div&gt;</div><div class="line">    );</div><div class="line">&#125;;</div><div class="line">AddTodo = connect()(AddTodo); // 注入 dispatch</div><div class="line"></div><div class="line">const Todo = (&#123; text, onClick, completed &#125;) =&gt; (</div><div class="line">    &lt;li</div><div class="line">        onClick=&#123;onClick&#125;</div><div class="line">        style=&#123;&#123;</div><div class="line">            textDecoration: completed</div><div class="line">                ? 'line-through'</div><div class="line">                : 'none',</div><div class="line">            cursor: completed</div><div class="line">                ? 'default'</div><div class="line">                : 'pointer',</div><div class="line">        &#125;&#125;</div><div class="line">    &gt;</div><div class="line">        &#123;text&#125;</div><div class="line">    &lt;/li&gt;</div><div class="line">);</div><div class="line"></div><div class="line">const TodoList = (&#123; todos, onTodoClick &#125;) =&gt; (</div><div class="line">    &lt;ul&gt;</div><div class="line">        &#123;todos.map(todo =&gt;</div><div class="line">            &lt;Todo</div><div class="line">                key=&#123;todo.id&#125;</div><div class="line">                &#123;...todo&#125;</div><div class="line">                onClick=&#123;() =&gt; onTodoClick(todo.id)&#125;</div><div class="line">            /&gt;</div><div class="line">        )&#125;</div><div class="line">    &lt;/ul&gt;</div><div class="line">);</div><div class="line"></div><div class="line">// 根据当前 filter 过滤需要渲染的 todos</div><div class="line">const getVisibleTodos = (todos, filter) =&gt; &#123;</div><div class="line">    switch (filter) &#123;</div><div class="line">        case 'SHOW_ALL':</div><div class="line">            return todos;</div><div class="line"></div><div class="line">        case 'SHOW_COMPLETED':</div><div class="line">            return todos.filter(todo =&gt; todo.completed);</div><div class="line"></div><div class="line">        case 'SHOW_ACTIVE':</div><div class="line">            return todos.filter(todo =&gt; !todo.completed);</div><div class="line"></div><div class="line">        default:</div><div class="line">            return todos;</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line">const mapStateToTodoListProps = (state) =&gt; (&#123;</div><div class="line">    todos: getVisibleTodos(</div><div class="line">        state.todos,</div><div class="line">        state.filter</div><div class="line">    ),</div><div class="line">&#125;);</div><div class="line"></div><div class="line">const mapDispatchToTodoListProps = (dispatch) =&gt; (&#123;</div><div class="line">    onTodoClick(id) &#123;</div><div class="line">        dispatch(toggleTodo(id))</div><div class="line">    &#125;,</div><div class="line">&#125;);</div><div class="line"></div><div class="line">const VisibleTodoList = connect(</div><div class="line">    mapStateToTodoListProps,</div><div class="line">    mapDispatchToTodoListProps,</div><div class="line">)(TodoList);</div><div class="line"></div><div class="line">// 原本的 FilterLink 改成 Link，去掉 filter 和 renderFilter 属性，改为传入 active</div><div class="line">const Link = (&#123; active, onClick, children &#125;) =&gt; &#123;</div><div class="line">    if (active) return (&lt;span&gt;&#123;children&#125;&lt;/span&gt;);</div><div class="line"></div><div class="line">    return (</div><div class="line">        &lt;a href='#' onClick=&#123;e =&gt; &#123;</div><div class="line">            e.preventDefault();</div><div class="line">            onClick();</div><div class="line">        &#125;&#125;&gt;</div><div class="line">            &#123;children&#125;</div><div class="line">        &lt;/a&gt;</div><div class="line">    );</div><div class="line">&#125;;</div><div class="line"></div><div class="line">const mapStateToLinkProps = (state, ownProps) =&gt; (&#123;</div><div class="line">    // ownProps 是原组件的 props，</div><div class="line">    // 这里为了和高阶组件的 props 区分</div><div class="line">    active: ownProps.renderFilter === state.filter,</div><div class="line">&#125;);</div><div class="line"></div><div class="line">const mapDispatchToLinkProps = (dispatch, ownProps) =&gt; (&#123;</div><div class="line">    onClick() &#123;</div><div class="line">        dispatch(</div><div class="line">            setVisibilityFilter(ownProps.renderFilter)</div><div class="line">        );</div><div class="line">    &#125;,</div><div class="line">&#125;);</div><div class="line"></div><div class="line">// 注意原 FilterLink 整个都被我们删了</div><div class="line">const FilterLink = connect(</div><div class="line">    mapStateToLinkProps,</div><div class="line">    mapDispatchToLinkProps</div><div class="line">)(Link);</div><div class="line"></div><div class="line">const Footer = () =&gt; (</div><div class="line">    &lt;p&gt;</div><div class="line">        Show:</div><div class="line">        &#123;' '&#125;</div><div class="line">        &lt;FilterLink renderFilter="SHOW_ALL"&gt;</div><div class="line">            all</div><div class="line">        &lt;/FilterLink&gt;</div><div class="line">        &#123;', '&#125;</div><div class="line">        &lt;FilterLink renderFilter="SHOW_COMPLETED"&gt;</div><div class="line">            completed</div><div class="line">        &lt;/FilterLink&gt;</div><div class="line">        &#123;', '&#125;</div><div class="line">        &lt;FilterLink renderFilter="SHOW_ACTIVE"&gt;</div><div class="line">            active</div><div class="line">        &lt;/FilterLink&gt;</div><div class="line">    &lt;/p&gt;</div><div class="line">);</div><div class="line"></div><div class="line">// 清清爽爽~再也不用费劲儿地传入 store 了~</div><div class="line">const TodoApp = () =&gt; (</div><div class="line">    &lt;div&gt;</div><div class="line">        &lt;AddTodo /&gt;</div><div class="line">        &lt;VisibleTodoList /&gt;</div><div class="line">        &lt;Footer /&gt;</div><div class="line">    &lt;/div&gt;</div><div class="line">);</div><div class="line"></div><div class="line">/*-- ReactDOM 渲染部分 --*/</div><div class="line">ReactDOM.render(</div><div class="line">    &lt;Provider store=&#123;createStore(rootReducer, initialState)&#125;&gt;</div><div class="line">        &lt;TodoApp /&gt;</div><div class="line">    &lt;/Provider&gt;,</div><div class="line">    document.getElementById('container'),</div><div class="line">);</div></pre></td></tr></table></figure>
<h1 id="四、总结"><a href="#四、总结" class="headerlink" title="四、总结"></a>四、总结</h1><p>本文从 Redux 的理论基础和源码出发，介绍了 Redux 的各项基础 api。</p>
<p>接着一步一步地介绍如何与 React 进行结合，从过程中的各个痛点引出 react-redux 的作用和原理。</p>
<p>然鹅，还有好多的坑没填，比如：大型项目的文件结构、前端路由（react-router）、中间件（middlewares）、网络请求等各类异步操作、服务器端同构直出…</p>
<p>以上 to be continued…</p>
<p>参考引用博客<br><a href="https://buptsteve.github.io/blog/2016/10/25/7.react-and-redux-learning-note-basics/" target="_blank" rel="external">https://buptsteve.github.io/blog/2016/10/25/7.react-and-redux-learning-note-basics/</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;零、环境搭建&quot;&gt;&lt;a href=&quot;#零、环境搭建&quot; class=&quot;headerlink&quot; title=&quot;零、环境搭建&quot;&gt;&lt;/a&gt;零、环境搭建&lt;/h1&gt;&lt;p&gt;&lt;strong&gt;参考资料&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;http://red
    
    </summary>
    
      <category term="前端" scheme="https://wudi2010.github.io/blog/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
      <category term="JavaScript" scheme="https://wudi2010.github.io/blog/tags/JavaScript/"/>
    
      <category term="React" scheme="https://wudi2010.github.io/blog/tags/React/"/>
    
      <category term="Redux" scheme="https://wudi2010.github.io/blog/tags/Redux/"/>
    
  </entry>
  
  <entry>
    <title>最新开始的博客</title>
    <link href="https://wudi2010.github.io/blog/2016/12/02/My-New-Post/"/>
    <id>https://wudi2010.github.io/blog/2016/12/02/My-New-Post/</id>
    <published>2016-12-02T06:30:17.000Z</published>
    <updated>2016-12-03T06:27:45.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="使用说明"><a href="#使用说明" class="headerlink" title="使用说明"></a>使用说明</h2><h3 id="重点说明模块"><a href="#重点说明模块" class="headerlink" title="重点说明模块"></a>重点说明模块</h3><blockquote><p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque hendrerit lacus ut purus iaculis feugiat. Sed nec tempor elit, quis aliquam neque. Curabitur sed diam eget dolor fermentum semper at eu lorem.</p>
</blockquote>
<blockquote><p>Do not just seek happiness for yourself. Seek happiness for all. Through kindness. Through mercy.</p>
<footer><strong>David Levithan</strong><cite>Wide Awake</cite></footer></blockquote>
<h3 id="代码模块"><a href="#代码模块" class="headerlink" title="代码模块"></a>代码模块</h3><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[rectangle setX: <span class="number">10</span> y: <span class="number">10</span> width: <span class="number">20</span> height: <span class="number">20</span>];</div></pre></td></tr></table></figure>
<figure class="highlight plain"><figcaption><span>Array.map</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">array.map(callback[, thisArg])</div></pre></td></tr></table></figure>
<blockquote class="pullquote [class]"><p>content</p>
</blockquote>
<h3 id="webstorm-11代码自动换行"><a href="#webstorm-11代码自动换行" class="headerlink" title="webstorm 11代码自动换行"></a>webstorm 11代码自动换行</h3><p>开始写的时候才发现代码根本不会自己换行,去网上找教程依然找不到其他网友说的IDE settings,应该也是由于是版本不同的问题,后来在preferences-editor-general中找到了Use soft wraps in editor选项,勾选上即可自动换行.</p>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;使用说明&quot;&gt;&lt;a href=&quot;#使用说明&quot; class=&quot;headerlink&quot; title=&quot;使用说明&quot;&gt;&lt;/a&gt;使用说明&lt;/h2&gt;&lt;h3 id=&quot;重点说明模块&quot;&gt;&lt;a href=&quot;#重点说明模块&quot; class=&quot;headerlink&quot; title=&quot;重点说明模
    
    </summary>
    
      <category term="技术总结" scheme="https://wudi2010.github.io/blog/categories/%E6%8A%80%E6%9C%AF%E6%80%BB%E7%BB%93/"/>
    
    
      <category term="Injury" scheme="https://wudi2010.github.io/blog/tags/Injury/"/>
    
      <category term="Fight" scheme="https://wudi2010.github.io/blog/tags/Fight/"/>
    
      <category term="Shocking" scheme="https://wudi2010.github.io/blog/tags/Shocking/"/>
    
  </entry>
  
  <entry>
    <title>博客第一篇</title>
    <link href="https://wudi2010.github.io/blog/2016/12/02/0-blog-first/"/>
    <id>https://wudi2010.github.io/blog/2016/12/02/0-blog-first/</id>
    <published>2016-12-02T06:30:17.000Z</published>
    <updated>2016-12-05T07:18:28.000Z</updated>
    
    <content type="html"><![CDATA[<p>做为一个IT搞技术的，时刻不能放下学习，写文档笔记可以帮助我梳理学习的内容知识，巩固学习内容。在工作中还可以服务于他人，可为一举多得。原来写文档笔记载体是有道云笔记、WORD文档+网盘自己管理弄得技术笔记很茅草，不能很好的梳理技术知识，这是我建立这个技术博客的初衷。目标帮助自己和我的团队更好的完成日后的工作任务。</p>
<h2 id="博客的建立"><a href="#博客的建立" class="headerlink" title="博客的建立"></a>博客的建立</h2><p>其实博客的建立非常的偶然，做了好多年技术开发，时长看到别人编写技术博客。有时想自己写写，因为懒，嘿嘿都错过了。平时梳理技术的时候，也记些笔记，不过觉得做的还是不够精细，基本上复制粘贴的多，很多坑就自己知道。实际给别人看的时候，有时候也在坑别人。觉得还是写的态度有点不到位。偶然间看到一个前端开发者的博客，笔记内容写的比较新颖，于是决定使用他使用的技术，编写博客，把技术笔记放上去服务自己服务他人。选择的技术是nodejs为基础环境的<a href="http://hexo.io" target="_blank" rel="external">hexo3</a>。</p>
<p>主要是这几个优点吧(以下内容引用复制多一些，不过自己以完全实践过，多见谅）:</p>
<p>主要是这几个优点吧：</p>
<ul>
<li>免费╮(╯▽╰)╭</li>
<li>基于 Node.js</li>
<li>速度快、操作更简单、命令少，专注于写作本身</li>
<li>由于 deploy 命令，发布到 github 上生成静态站点也很简单<br>所以整个 Blog 就是采用 <a href="http://hexo.io" target="_blank" rel="external">hexo3</a> + <a href="https://github.com" target="_blank" rel="external">github pages</a>,主题基于 <a href="https://github.com/yscoder/hexo-theme-indigo" target="_blank" rel="external">indigo</a> 进行修改，下面就详细说说怎么搭起来吧.<h3 id="hexo在MAC下的安装"><a href="#hexo在MAC下的安装" class="headerlink" title="hexo在MAC下的安装"></a>hexo在MAC下的安装</h3>Hexo 是一个快速、简洁且高效的博客框架。Hexo 使用 Markdown（或其他渲染引擎）解析文章，在几秒内，即可利用靓丽的主题生成静态网页。Hexo的安装是个很快速简便的过程，但依然还是有不少坑。这里记录个我的安装过程，给大家一些参考。以下是我安装时系统及软件版本，请尽量保证不低于这些版本号：</li>
</ul>
<ul>
<li>OS ： OS X EI Capitan 10.11.3</li>
<li>XCode : 7.3</li>
<li>hexo : 3.2.2</li>
<li>node : 4.4.7</li>
<li>Git : 2.6.4</li>
</ul>
<h4 id="安装前提"><a href="#安装前提" class="headerlink" title="安装前提"></a>安装前提</h4><p>需要安装 Node.js 和 Git 两个应用程序，直接到官网安装最新版本即可，如已安装请跳过。</p>
<ul>
<li><p><a href="http://nodejs.org" target="_blank" rel="external">Node.js</a> 官网</p>
</li>
<li><p><a href="https://github.com" target="_blank" rel="external">Git</a> 官网</p>
</li>
</ul>
<h4 id="安装Hexo"><a href="#安装Hexo" class="headerlink" title="安装Hexo"></a>安装Hexo</h4><p>安装完Node.js 及 Git 后，即可使用npm来安装Hexo</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ npm i(nstall) -g hexo</div></pre></td></tr></table></figure>
<p>npm 安装方式中 -g 的意思是全局安装。</p>
<h4 id="初始化Hexo"><a href="#初始化Hexo" class="headerlink" title="初始化Hexo"></a>初始化Hexo</h4><p>创建一个目录用来作为你的blog目录，例如 MyBlog；并在该目录中进行Hexo的初始化：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ hexo init MyB<span class="built_in">log</span></div><div class="line">$ <span class="built_in">cd</span> ~/MyB<span class="built_in">log</span>/</div><div class="line">$ npm install</div></pre></td></tr></table></figure>
<p>新建完成后得到以下目录：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">·</div><div class="line">|-- _config.yml</div><div class="line">|-- package.json</div><div class="line">|-- scaffolds</div><div class="line">|-- source</div><div class="line">|   |-- _drafts</div><div class="line">|   |-- _posts</div><div class="line">|-- themes</div></pre></td></tr></table></figure></p>
<p>至此，你就完成了Hexo的安装及初始化，接下来我们就可以进行本地的预览啦：<br>先安装hexo server</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ npm i(nstall) --save  hexo-server</div></pre></td></tr></table></figure>
<blockquote><p>npm 安装方式中 –save 的意思是作为项目依赖(dependencies)进行安装，可以缩写为 -S (注意大写)<br>此外还有 –save-dev 的意思是作为项目的「开发」依赖(devDependencies)进行安装，可以缩写为 -D (注意大写)<br>这两种安装方式都会将这个包的名称和版本写进 package.json 配置文件中</p>
</blockquote>
<p>然后生成静态页面并打开hexo本地服务</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ hexo g(enerate)   (或 hexo g)</div><div class="line">$ hexo s(erver) (或 hexo s)</div></pre></td></tr></table></figure>
<p>按命令行提示，打开 <a href="http://localhost:4000/" target="_blank" rel="external">http://localhost:4000/</a> 即可看到默认主题的默认页面了。<br>可能加载会很慢，因为默认主题中使用了些Google的资源，后面更换主题就会快很多了。</p>
<h4 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h4><h5 id="与Github账户关联"><a href="#与Github账户关联" class="headerlink" title="与Github账户关联"></a>与Github账户关联</h5><p>首先需要去<a href="https://github.com" target="_blank" rel="external">Github</a>注册一个账号，并新建一个名为 [your_account].github.io 的仓库。 </p>
<blockquote><p>个人在此位置的时候遇到了好多问题，解决了好久。github原来没有用过，github.io域名的仓库怎么建立？怎么部署到github上？学习好久，这其中有两个坑，下面把他先填上。</p>
</blockquote>
<h6 id="关于-github-pages"><a href="#关于-github-pages" class="headerlink" title="关于 github pages"></a>关于 github pages</h6><ol>
<li>项目站点（Project Pages）<br>github 会根据 gh-pages 分支下文件生成静态页面，地址是 [yourName].github.io/[projectName]。（[yourName] 是你的账户名，[projectName] 是你的项目名）</li>
<li>个人或公司站点（User/Organization Pages）<br>首先要创建一个叫做 [yourName].github.io 的项目，接着 github 会根据 master 分支下文件生成静态页面，地址是 [yourName].github.io/。</li>
</ol>
<h6 id="生成-github-pages"><a href="#生成-github-pages" class="headerlink" title="生成 github pages"></a>生成 github pages</h6><blockquote>
<p>此处坑已填</p>
</blockquote>
<ol>
<li>首先在github上建立一个项目，如果是项目站点用[projectName],个人站点用[yourname]。</li>
<li>进入你所建立的项目中，点击项目配置[settings]选项，配置改项目</li>
<li>下拉设置页面，找到GitHub Pages区域，点击[Lauch automatic page generator]按钮，就会按照你的定义生成一个项目介绍的模板，同样这时github pages，你要配置的项目站点或个人站点将已经启动。</li>
</ol>
<h4 id="部署上传Blog"><a href="#部署上传Blog" class="headerlink" title="部署上传Blog"></a>部署上传Blog</h4><p>通过Hexo的部署命令，直接可以将编写好的blog上传到网络空间，对外发布。<br>部署上传配置如下：<br>打开前面创建的MyBlog目录下的 _config.yml 文件，在修改最下方的deploy为：<br>*注意，冒号后面一定要加空格<br>官方文档中是这么介绍的</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"># You can use this:</div><div class="line">deploy:</div><div class="line">  type: git</div><div class="line">  repo: &lt;repository url&gt;</div><div class="line">  branch: [branch]</div><div class="line">  message: [message]</div><div class="line"># or this:</div><div class="line">deploy:</div><div class="line">  type: git</div><div class="line">  message: [message]</div><div class="line">  repo:</div><div class="line">    github: &lt;repository url&gt;,[branch]</div><div class="line">    gitcafe: &lt;repository url&gt;,[branch]</div><div class="line">    </div><div class="line">#repo: Repository URL</div><div class="line">#branch: Git branch to deploy the static site to</div><div class="line">#message: Commit message. The default commit message is Site updated: &#123;&#123; now(&apos;YYYY-MM-DD HH:mm:ss&apos;) &#125;&#125;.</div></pre></td></tr></table></figure>
<p>接下来安装hexo的git部署，在命令行中执行：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ npm install hexo-deployer-git --save</div></pre></td></tr></table></figure></p>
<p>最后，将生成静态页面并部署到github的仓库中，执行：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">$ hexo d -g </div><div class="line">或者</div><div class="line">$ hexo generate</div><div class="line">$ hexo deploy</div></pre></td></tr></table></figure></p>
<p>当提示 <strong> INFO Deploy done: git 即上传成功，这时就可以通过 </strong>http:\/\/[your_account].github.io 来访问你的个人站点,如果是项目站点增加[projectName]。</p>
<blockquote>
<p>此处有坑，刚注册完成github的，如果不配置sshkeys或者是gpgkey是部署不到gitpages中。所以ssh应该生成ssh的公司密钥对，gpg应该生成gpg公司密钥对，本人gpg是参见官方文档完成。具体内容如下：</p>
<ol>
<li><a href="https://www.gnupg.org/download/" target="_blank" rel="external">Download and install the GPG command line tools</a> 下载GPG命令行工具</li>
<li>打开系统命令行执行。Open Terminal。</li>
<li>生成 GPG key。<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">gpg --gen-key</div></pre></td></tr></table></figure>
</li>
</ol>
</blockquote>
<h5 id="hexo的基本配置"><a href="#hexo的基本配置" class="headerlink" title="hexo的基本配置"></a>hexo的基本配置</h5><p>以下是hexo配置文件 _config.yml 的基本内容及基本设置，更多个性化设置请参考官方文档：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div></pre></td><td class="code"><pre><div class="line"># Hexo Configuration</div><div class="line">## Docs: https://hexo.io/docs/configuration.html</div><div class="line">## Source: https://github.com/hexojs/hexo/</div><div class="line"># Site  ##页面信息</div><div class="line">title: Who&apos;s Blog  ##标题，即浏览器标签栏显示的内容</div><div class="line">subtitle: Why so serious?  ##副标题</div><div class="line">description:        ##描述，简介</div><div class="line">author: wu di  ##作者</div><div class="line">language: zh-CN  ##语言</div><div class="line">timezone: Asia/Shanghai  ##时区</div><div class="line"></div><div class="line"># URL</div><div class="line">## If your site is put in a subdirectory, set url as &apos;http://yoursite.com/child&apos; and root as &apos;/child/&apos;</div><div class="line">url: http://wwww.charleswei.me  ##域名，后面自定义域名后，写在这里，用 .github.io的话，这里用默认的不用改</div><div class="line">root: /</div><div class="line">permalink: :year/:month/:day/:title/</div><div class="line">permalink_defaults:</div><div class="line"></div><div class="line"># Directory  ##文件目录，可不改</div><div class="line">source_dir: source</div><div class="line">public_dir: public</div><div class="line">tag_dir: tags</div><div class="line">archive_dir: archives</div><div class="line">category_dir: categories</div><div class="line">code_dir: downloads/code</div><div class="line">i18n_dir: :lang</div><div class="line">skip_render:</div><div class="line"># Writing  ##静态页面生成属性，可不改</div><div class="line">new_post_name: :year-:month-:day-:title.md # File name of new posts</div><div class="line">default_layout: post</div><div class="line">titlecase: false # Transform title into titlecase</div><div class="line">external_link: true # Open external links in new tab</div><div class="line">filename_case: 0</div><div class="line">render_drafts: false</div><div class="line">post_asset_folder: false</div><div class="line">relative_link: false</div><div class="line">future: true</div><div class="line">highlight: </div><div class="line">  enable: true </div><div class="line">  line_number: true </div><div class="line">  auto_detect: false </div><div class="line">  tab_replace:</div><div class="line"></div><div class="line"># Category &amp; Tag ##标签，可不改</div><div class="line">default_category: uncategorized</div><div class="line">category_map:</div><div class="line">tag_map:</div><div class="line"># Date / Time format  ##时间格式，可不改</div><div class="line">## Hexo uses Moment.js to parse and display date</div><div class="line">## You can customize the date format as defined in</div><div class="line">## http://momentjs.com/docs/#/displaying/format/</div><div class="line">date_format: YYYY-MM-DD</div><div class="line">time_format: HH:mm:ss</div><div class="line"></div><div class="line"># Pagination ##每页显示文章数，按需改</div><div class="line">## Set per_page to 0 to disable pagination</div><div class="line">per_page: 10</div><div class="line">pagination_dir: page</div><div class="line"># Extensions ##主题设置</div><div class="line">## Plugins: https://hexo.io/plugins/</div><div class="line">## Themes: https://hexo.io/themes/</div><div class="line">theme: indigo</div><div class="line"></div><div class="line"># Deployment  ##git部署关联</div><div class="line">## Docs: https://hexo.io/docs/deployment.html</div><div class="line">deploy: </div><div class="line">  type: git </div><div class="line">  repo: https://github.com/wudi2010/blog.git,gh_pages</div><div class="line">  branch: master</div></pre></td></tr></table></figure>
<h5 id="主题配置"><a href="#主题配置" class="headerlink" title="主题配置"></a>主题配置</h5><p>Hexo具有高定制的主题效果，你可以从Hexo的主题库中选择合适的主题，也可以自己制作。<br>以我现在使用的indigo主题为例。首先将主题库clone到MyBlog目录下的themes目录：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git <span class="built_in">clone</span> git@github.com:yscoder/hexo-theme-indigo.git themes/indigo</div></pre></td></tr></table></figure>
<p>安装less，主题使用less作为css预处理工具：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm install hexo-renderer-less --save</div></pre></td></tr></table></figure>
<p>安装feed,用于生吃RSS：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm install hexo-generator-feed --save</div></pre></td></tr></table></figure>
<p>安装json-content，用于生成静态站点数据，提供搜索功能的数据源：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm install hexo-generator-json-content --save</div></pre></td></tr></table></figure>
<p>开启标签页：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">hexo new page tags</div></pre></td></tr></table></figure>
<p>修改MyBlog/source/tags/index.md的源数据：</p>
<blockquote>
<p>此处有坑，网上各地方的答案根本不好使，请严格按照下方编写。<br><figure class="highlight markdown"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">layout: tags</div><div class="line">noDate: true</div><div class="line"><span class="section">comments: false</span></div><div class="line">---</div></pre></td></tr></table></figure></p>
</blockquote>
<p>修改hexo配置文件_config.yml中的主题标签：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">theme: indigo</div></pre></td></tr></table></figure>
<p>最后修改主题配置文件MyBlog/themes/indigo/_config.yml：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div></pre></td><td class="code"><pre><div class="line"># hexo-theme-indigo</div><div class="line"># https://github.com/yscoder/hexo-theme-indigo</div><div class="line"></div><div class="line">#添加新菜单项遵循以下规则</div><div class="line"># menu:</div><div class="line">#  link:               fontawesome图标，省略前缀，本主题前缀为 icon-，必须</div><div class="line">#    text: About       菜单显示的文字，如果省略即默认与图标一致，首字母会转大写</div><div class="line">#    url: /about       链接，绝对或相对路径，必须。</div><div class="line">#    target: _blank    是否跳出，省略则在当前页面打开</div><div class="line">menu:</div><div class="line">  home:</div><div class="line">    text: 主页</div><div class="line">    url: /</div><div class="line">  archives:</div><div class="line">    text: 归档</div><div class="line">    url: /archives</div><div class="line">  tags:</div><div class="line">    text: 标签</div><div class="line">    url: /tags</div><div class="line">  th:</div><div class="line">    text: 分类</div><div class="line">    url: /categories</div><div class="line">  github:</div><div class="line">    url: https://github.com/wudi2010</div><div class="line">    target: _blank</div><div class="line">  about:</div><div class="line">    text: 关于</div><div class="line">    url: /about</div><div class="line"></div><div class="line"></div><div class="line">rss: /atom.xml</div><div class="line"></div><div class="line">#你的头像url</div><div class="line">avatar: /img/avatar.jpg</div><div class="line">#favicon</div><div class="line">favicon: /img/favicon.ico</div><div class="line"></div><div class="line"># email</div><div class="line">email: 28679382@qq.com</div><div class="line"></div><div class="line"># 设置 Android L Chrome 浏览器状态栏颜色</div><div class="line">color: &apos;#3F51B5&apos;</div><div class="line"></div><div class="line"></div><div class="line"># 页面标题</div><div class="line">tags_title: 标签</div><div class="line">archives_title: 归档</div><div class="line">categories_title: 分类</div><div class="line"></div><div class="line"># 文章截断</div><div class="line">excerpt_render: false</div><div class="line">excerpt_length: 300</div><div class="line">excerpt_link: 阅读全文...</div><div class="line">mathjax: false</div><div class="line">archive_yearly: true</div><div class="line"></div><div class="line">#是否开启分享</div><div class="line">share: true</div><div class="line"></div><div class="line">#是否开启打赏，关闭 reward: false</div><div class="line">reward: false</div><div class="line">title: 谢谢大爷~</div><div class="line">wechat: /img/wechat.jpg     #微信，关闭设为 false</div><div class="line">alipay: /img/alipay.jpg     #支付宝，关闭设为 false</div><div class="line"></div><div class="line">#是否开启搜索</div><div class="line">search: true</div><div class="line"></div><div class="line">#是否大屏幕下文章页隐藏导航</div><div class="line">hideMenu: false</div><div class="line"></div><div class="line">#是否开启toc</div><div class="line">#toc: false</div><div class="line">toc:</div><div class="line">  list_number: true  # 是否显示数字排序</div><div class="line"></div><div class="line">#文章页版权声明内容，hexo中所有变量及辅助函数等均可调用，具体请查阅 hexo.io</div><div class="line">copyright: 本文地址：&lt;a href=&quot;&lt;%- url_for(page.path).replace(/index\.html$/, &apos;&apos;) %&gt;&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;&lt;%- url.replace(/index\.html$/, &apos;&apos;) %&gt;&lt;/a&gt;</div><div class="line"></div><div class="line">#站长统计，如要开启，输入CNZZ站点id，如 cnzz: 1255152447</div><div class="line">cnzz: false</div><div class="line"></div><div class="line"># Miscellaneous</div><div class="line">google_analytics: false</div><div class="line">google_site_verification: false</div><div class="line"></div><div class="line"># less</div><div class="line">less:</div><div class="line">  compress: true</div><div class="line">  paths:</div><div class="line">    - source/css/style.less</div><div class="line"></div><div class="line"># 是否开启多说评论，填写你在多说创建的站点二级域名</div><div class="line">duoshuo: ysblog</div><div class="line"># 使用 disqus 时关闭多说评论</div><div class="line">#disqus_shortname: false</div><div class="line"></div><div class="line"># 规范网址</div><div class="line"># 让搜索引擎重定向你的不同域名、不同子域、同域不同目录的站点到你期望的路径</div><div class="line"># https://support.google.com/webmasters/answer/139066</div><div class="line"># 假设配置为 canonical: http://imys.net，那么从搜索引擎中 www.imys.net 进入会重定向到 imys.net</div><div class="line">canonical: false</div><div class="line"></div><div class="line"># 版权起始年份</div><div class="line">since_year: 2016</div><div class="line"></div><div class="line"># 用户页面中作者相关的描述性文字，如不需要设为 false</div><div class="line">about: false</div></pre></td></tr></table></figure>
<p>最后生成部署，来看看效果吧<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">hexo clean</div><div class="line">hexo d -g</div></pre></td></tr></table></figure></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;做为一个IT搞技术的，时刻不能放下学习，写文档笔记可以帮助我梳理学习的内容知识，巩固学习内容。在工作中还可以服务于他人，可为一举多得。原来写文档笔记载体是有道云笔记、WORD文档+网盘自己管理弄得技术笔记很茅草，不能很好的梳理技术知识，这是我建立这个技术博客的初衷。目标帮助
    
    </summary>
    
    
      <category term="hexo3" scheme="https://wudi2010.github.io/blog/tags/hexo3/"/>
    
  </entry>
  
</feed>
